"use strict";var c=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var b=(t,n)=>{for(var o in n)c(t,o,{get:n[o],enumerable:!0})},h=(t,n,o,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of S(n))!E.call(t,r)&&r!==o&&c(t,r,{get:()=>n[r],enumerable:!(s=V(n,r))||s.enumerable});return t};var g=t=>h(c({},"__esModule",{value:!0}),t);var D={};b(D,{CreateFormStoreBuilder:()=>w,handlePreSubmit:()=>C});module.exports=g(D);function y(t){return t instanceof Object&&"parseAsync"in t&&typeof t.parseAsync=="function"}function N(t){return t instanceof Object&&"errors"in t}function p(t){return N(t)?t.format()._errors.join(", "):t instanceof Error?t.message:"Something went wrong!"}function k(t,n){if(!t.initValues||typeof t.initValues!="object")throw new Error("");let o={baseId:n,formId:`${n}_form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};o.fieldsNames=Object.keys(t.initValues);for(let s of o.fieldsNames)o.fieldsNamesMap[s]=!0;for(let s in t.validationsSchema){if(o.validatedFieldsNames.push(s),o.validatedFieldsNamesMap[s]=!0,s in o.fieldsNamesMap){o.referencedValidatedFields.push(s),o.referencedValidatedFieldsMap[s]=!0;continue}o.manualValidatedFields.push(s),o.manualValidatedFieldsMap[s]=!0}return o}function H(t,n){let o={submit:!0},s=!1,r,m={};for(let i of n.validatedFieldsNames){let a=t.validationsSchema?.[i];if(m[i]={handler:a?y(a)?l=>a.parse(l):a:void 0,failedAttempts:0,passedAttempts:0,events:{change:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null},submit:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null}},isDirty:!1,metadata:{name:i}},t.validationEvents&&(s=!0,o={...o,...t.validationEvents}),s)for(r in o)m[i].events[r].isActive=!!typeof o[r]}return m}function A(t,n,o){let s={};for(let r of o.fieldsNames)s[r]={value:t.initValues[r],isUpdatingValueOnError:t.isUpdatingFieldsValueOnError,valueFromFieldToStore:t.valuesFromFieldsToStore?.[r]?t.valuesFromFieldsToStore[r]:void 0,valueFromStoreToField:t.valuesFromStoreToFields?.[r]?t.valuesFromStoreToFields[r]:void 0,errors:null,isDirty:!1,id:`${n}field-${String(r)}`,metadata:{name:r,initialValue:s[r].value}};return s}var T={fields:!0,validations:!0,submitCounter:!1};function w(t){let n=t.baseId?`${t.baseId}-`:"",o=k(t,n),s=A(t,n,o),r=H(t,o);return m=>({baseId:n,metadata:o,validations:r,fields:s,id:`${n}-form`,isDirty:!1,isSubmitting:!1,submitCounter:0,currentErrorsCounter:0,utils:{setIsSubmitting(i){m(function(a){return{...a,isSubmitting:typeof i=="function"?i(a.isSubmitting):i}})},resetFormStore:function(i=T){return m(function(a){let l=a.fields,e=a.validations,f=a.isDirty,d=a.submitCounter;if(i.fields)for(let u in l)l[u].value=l[u].metadata.initialValue;if(i.validations){for(let u in e){e[u].failedAttempts=0,e[u].passedAttempts=0,e[u].isDirty=!1;let F;for(F in e[u].events)e[u].events[F].failedAttempts=0,e[u].events[F].passedAttempts=0,e[u].events[F].isDirty=!1,e[u].events[F].message=null}f=!1}return i.submitCounter&&(d=0),{...a,fields:l,validations:e,isDirty:f,submitCounter:d}})},setFieldValue(i,a){return m(function(l){return{fields:{...l.fields,[i]:{...l.fields[i],value:typeof a=="function"?a(l.fields[i].value):a}}}})},setFieldErrors(i){m(function(a){if(!a.validations[i.name].events[i.validationEvent].isActive)return a;let l=a.currentErrorsCounter,e=a.validations[i.name],f=!!i.error;return f?(e.failedAttempts++,e.currentErrorsCounter++,l++,e.events[i.validationEvent].message=i.error,e.events[i.validationEvent].isDirty=f,e.events[i.validationEvent].failedAttempts++):(e.passedAttempts++,e.currentErrorsCounter--,l--,e.events[i.validationEvent].message=i.error,e.events[i.validationEvent].isDirty=f,e.events[i.validationEvent].passedAttempts++),e.isDirty=e.currentErrorsCounter===0,{...a,currentErrorsCounter:l,isDirty:l===0,validation:e}})},errorFormatter:t.errorFormatter??p,handleOnInputChange(i,a,l){m(function(e){let f=e.fields[i],d=l||(e.metadata.referencedValidatedFieldsMap[i]?i:void 0);if(d&&e.validations[d].events.change.isActive)try{e.utils.setFieldValue(i,e.validations[d].handler(typeof a=="function"?a(f.value):f.valueFromFieldToStore?f.valueFromFieldToStore(a):a,"change")),e.utils.setFieldErrors({name:d,error:null,validationEvent:"change"})}catch(u){e.utils.setFieldErrors({name:d,error:e.utils.errorFormatter(u,"change"),validationEvent:"change"})}else e.utils.setFieldValue(i,typeof a=="function"?a(f.value):f.valueFromFieldToStore?f.valueFromFieldToStore(a):a);return{...e,fields:{...e.fields,[i]:f}}})}}})}var C=function(t,n){return async function(o){o.preventDefault();let s=t();s.utils.setIsSubmitting(!0);let r=s.metadata,m=s.fields,i=s.validations,a={},l={},e={},f=!1,d;for(d in m){a[d]=m[d].value;try{let v=d in r.referencedValidatedFieldsMap&&i[d].handler;i[d].events.submit.isActive&&typeof v=="function"&&(l[d]=v(m[d].value,"submit")),e[d]={name:d,error:null,validationEvent:"submit"}}catch(v){e[d]={name:d,error:s.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}}let u;for(u of r.manualValidatedFields)try{let v=s.validations[u].handler;typeof v=="function"&&(l[u]=v(a,"submit")),e[u]={name:u,error:null,validationEvent:"submit"}}catch(v){e[u]={name:u,error:s.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}let F;for(F in e){let v=e[F];s.utils.setFieldErrors(e[F]),typeof v.error=="string"&&(f=!0)}s.utils.setIsSubmitting(!1),!f&&await n({event:o,values:a,validatedValues:l,hasError:f,errors:e})}};0&&(module.exports={CreateFormStoreBuilder,handlePreSubmit});
//# sourceMappingURL=..js.map