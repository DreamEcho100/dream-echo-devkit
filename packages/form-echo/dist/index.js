"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _chunkRP3TYKHIjs = require('./chunk-RP3TYKHI.js');function N(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function x(e){return e instanceof Object&&"errors"in e}function C(e){return x(e)?e.errors.map(o=>o.message).join(`
`):e instanceof Error?e.message:"Something went wrong!"}var g=class{constructor(a){this.id=a.id,this.value=a.value,this.metadata=a.metadata,this.valueFromFieldToStore=a.valueFromFieldToStore,this.valueFromStoreToField=_nullishCoalesce(a.valueFromStoreToField, () => ((o=>_nullishCoalesce(o, () => ("")))))}get storeToFieldValue(){return this.valueFromStoreToField(this.value)}};function _(e,a){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let o={baseId:a,formId:`${a}-form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};o.fieldsNames=Object.keys(e.initialValues);for(let t of o.fieldsNames)o.fieldsNamesMap[t]=!0;if(e.validationSchema)for(let t in e.validationSchema){if(o.validatedFieldsNames.push(t),o.validatedFieldsNamesMap[t]=!0,t in o.fieldsNamesMap){o.referencedValidatedFields.push(t),o.referencedValidatedFieldsMap[t]=!0;continue}o.manualValidatedFields.push(t),o.manualValidatedFieldsMap[t]=!0}return o}function P(e,a){let o={submit:!0,blur:!0},t=!1,u,v={};if(!e.validationSchema)return v;for(let V of a.validatedFieldsNames){let h=e.validationSchema[V];if(v[V]={handler:h?N(h)?b=>h.parse(b.value):h:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:_nullishCoalesce(_optionalChain([e, 'access', _2 => _2.validationEvents, 'optionalAccess', _3 => _3.blur]), () => (!0))},change:{failedAttempts:0,passedAttempts:0,isActive:_nullishCoalesce(_optionalChain([e, 'access', _4 => _4.validationEvents, 'optionalAccess', _5 => _5.change]), () => (!1))},submit:{failedAttempts:0,passedAttempts:0,isActive:_nullishCoalesce(_optionalChain([e, 'access', _6 => _6.validationEvents, 'optionalAccess', _7 => _7.submit]), () => (!0))}},currentEvent:null,isDirty:!1,metadata:{name:V}},e.validationEvents&&(t=!0,o={...o,...e.validationEvents}),t)for(u in o)v[V].events[u].isActive=!!typeof o[u]}return v}function I(e,a,o){let t={};for(let u of o.fieldsNames)t[u]=new g({value:e.initialValues[u],valueFromFieldToStore:_optionalChain([e, 'access', _8 => _8.valuesFromFieldsToStore, 'optionalAccess', _9 => _9[u]])?e.valuesFromFieldsToStore[u]:void 0,valueFromStoreToField:_optionalChain([e, 'access', _10 => _10.valuesFromStoreToFields, 'optionalAccess', _11 => _11[u]])?e.valuesFromStoreToFields[u]:void 0,id:`${a}field-${String(u)}`,metadata:{name:u,initialValue:e.initialValues[u]}});return t}function E(e){return function(a){if(!a.validations[e.name].events[e.validationEvent].isActive)return a;let o=a.currentDirtyFieldsCounter,t={...a.validations[e.name]};return t.currentEvent=e.validationEvent,e.message?(t.failedAttempts++,t.events[e.validationEvent].failedAttempts++,t.isDirty||(t.currentDirtyEventsCounter++,t.currentDirtyEventsCounter>0&&o++),t.error={message:e.message},t.isDirty=!0):(t.passedAttempts++,t.events[e.validationEvent].passedAttempts++,t.isDirty&&(t.currentDirtyEventsCounter--,t.currentDirtyEventsCounter===0&&o--),t.error=null,t.isDirty=!1),a.currentDirtyFieldsCounter=o,a.isDirty=o>0,a.validations={...a.validations,[e.name]:t},a}}function D(e,a){return function(o){let t=o.fields[e];return t.value=typeof a=="function"?a(t.value):a,{...o,fields:{...o.fields,[e]:t}}}}var j={fields:!0,validations:!0,submit:!1,focus:!0};function G(e,a,o){let t=()=>{let s=a(),n={},l;for(l in s.fields)n[l]=s.fields[l].value;return n},u=s=>a().fields[s].value,v=s=>{e(function(n){return{submit:{...n.submit,...typeof s=="function"?s(n.submit):s}}})},V=(s,n,l)=>{e(function(i){let r=i;if(!l&&r.validations[n].events.blur.isActive){try{r.validations[n].handler({value:n&&s!==n?r.getValues():r.fields[s].value,name:s,validationEvent:"blur",get:a,getValue:r._baseMethods.getValue,getValues:r._baseMethods.getValues}),r=E({name:n,message:null,validationEvent:"blur"})(r)}catch(S){let F=r.errorFormatter(S,"blur");r=E({name:n,message:F,validationEvent:"blur"})(r)}if(r.focus.isActive&&r.focus.field.name!==s)return r}return{getValue:r._baseMethods.getValue,getValues:r._baseMethods.getValues,focus:l?{isActive:!0,field:{name:s,id:r.fields[s].id}}:{isActive:!1,field:null}}})},h=(s=j)=>e(function(n){let l=n.fields,i=n.validations,r=n.isDirty,S=n.submit,F=n.focus;if(s.fields){let d;for(d in l)l[d].value=l[d].metadata.initialValue}if(s.validations){for(let d in i){i[d].failedAttempts=0,i[d].passedAttempts=0,i[d].currentEvent=null,i[d].isDirty=!1,i[d].error=null;let c;for(c in i[d].events)i[d].events[c].isActive=!1,i[d].events[c].failedAttempts=0,i[d].events[c].passedAttempts=0}r=!1}return s.submit&&(S={counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1}),s.focus&&(F={isActive:!1,field:null}),{fields:l,validations:i,isDirty:r,submit:S,focus:F}}),b=(s,n)=>e(D(s,n)),T=s=>{e(E(s))},B=_nullishCoalesce(o.errorFormatter, () => (C));return{getValues:t,errorFormatter:B,getValue:u,setSubmitState:v,setFocusState:V,resetFormStore:h,setFieldValue:b,setFieldError:T,handleInputChange:(s,n,l)=>{let i=a(),r=i.fields[s],S=typeof n=="function"?n(r.value):n,F=r.valueFromFieldToStore?r.valueFromFieldToStore(S):S,d=l||(i.metadata.referencedValidatedFieldsMap[s]?s:void 0),c=D,y=E;if(d&&i.validations[d].events.change.isActive)try{i=c(s,i.validations[d].handler({value:l&&l!==s?i.getValues():F,name:s,get:a,validationEvent:"change",getValue:i._baseMethods.getValue,getValues:i._baseMethods.getValues}))(i),i=y({name:d,message:null,validationEvent:"change"})(i)}catch(f){i=y({name:d,message:i.errorFormatter(f,"change"),validationEvent:"change"})(i),i=c(s,F)(i)}else i=c(s,F)(i);e(i)},getFieldEventsListeners:(s,n)=>{let l=a(),i=_nullishCoalesce(n, () => (s));return{onChange:r=>{l.handleInputChange(s,r.target.value)},onFocus:()=>{l.setFocusState(s,i,!0)},onBlur:()=>{l.setFocusState(s,i,!1)}}},handleSubmit:s=>async function(n){n.preventDefault();let l=a();l.setSubmitState({isActive:!0});let i=l.metadata,r=l.fields,S=l.validations,F={},d={},c={},y=!1,f;for(f in r){F[f]=r[f].value;try{let m=f in i.referencedValidatedFieldsMap&&S[f].handler;if(typeof m!="function"||!S[f].events.submit.isActive)continue;d[f]=m({value:r[f].value,name:f,get:a,validationEvent:"submit",...l._baseMethods}),c[f]={name:f,message:null,validationEvent:"submit"}}catch(m){c[f]={name:f,message:l.errorFormatter(m,"submit"),validationEvent:"submit"}}}let p;for(p of i.manualValidatedFields)try{let m=l.validations[p].handler;if(typeof m!="function")continue;d[p]=m({value:void 0,name:void 0,get:a,validationEvent:"submit",...l._baseMethods}),c[p]={name:p,message:null,validationEvent:"submit"}}catch(m){c[p]={name:p,message:l.errorFormatter(m,"submit"),validationEvent:"submit"}}let A=a(),M;for(M in c){let m=c[M];A=E(c[M])(A),typeof m.message=="string"&&(y=!0)}if(y)e(A),l.setSubmitState(m=>({isActive:!1,counter:m.counter+1,failedAttempts:m.counter+1,errorMessage:null}));else try{await s({event:n,values:F,validatedValues:d,hasError:y,errors:c}),l.setSubmitState(m=>({isActive:!1,counter:m.counter+1,passedAttempts:m.counter+1,errorMessage:null}))}catch(m){l.setSubmitState(k=>({isActive:!1,counter:k.counter+1,failedAttempts:k.counter+1,errorMessage:l.errorFormatter(m,"submit")}))}}}}function z(e){return(a,o)=>{let t=G(a,o,e),u=e.baseId?`${e.baseId}-`:"",v=_(e,u),V=I(e,u,v),h=P(e,v);return{baseId:u,metadata:v,validations:h,fields:V,id:`${u}form`,isDirty:!1,submit:{counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1},focus:{isActive:!1,field:null},currentDirtyFieldsCounter:0,_baseMethods:t,...t}}}exports.createFormStoreBuilder = z; exports.errorFormatter = C; exports.fvh = _chunkRP3TYKHIjs.e; exports.isZodError = x; exports.isZodValidator = N;
//# sourceMappingURL=index.js.map