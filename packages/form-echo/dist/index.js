"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _chunkCUZ5GBXNjs = require('./chunk-CUZ5GBXN.js');var b=class{constructor(a){this.id=a.id,this.value=a.value,this.metadata=a.metadata,this.valueFromFieldToStore=a.valueFromFieldToStore,this.valueFromStoreToField=_nullishCoalesce(a.valueFromStoreToField, () => ((o=>_nullishCoalesce(o, () => ("")))))}get storeToFieldValue(){return this.valueFromStoreToField(this.value)}};function M(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function D(e){return e instanceof Object&&"errors"in e}function N(e){return D(e)?e.format()._errors.join(", "):e instanceof Error?e.message:"Something went wrong!"}var _zustand = require('zustand');var _react = require('react');var H=e=>_zustand.createStore.call(void 0, T(e)),U= exports.useCreateFormStore =e=>{let a=_react.useId.call(void 0, );return _react.useState.call(void 0, H({...e,baseId:e.baseId||a}))[0]};function R(e,a){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let o={baseId:a,formId:`${a}-form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};o.fieldsNames=Object.keys(e.initialValues);for(let t of o.fieldsNames)o.fieldsNamesMap[t]=!0;if(e.validationSchema)for(let t in e.validationSchema){if(o.validatedFieldsNames.push(t),o.validatedFieldsNamesMap[t]=!0,t in o.fieldsNamesMap){o.referencedValidatedFields.push(t),o.referencedValidatedFieldsMap[t]=!0;continue}o.manualValidatedFields.push(t),o.manualValidatedFieldsMap[t]=!0}return o}function G(e,a){let o={submit:!0,blur:!0},t=!1,u,f={};if(!e.validationSchema)return f;for(let v of a.validatedFieldsNames){let h=e.validationSchema[v];if(f[v]={handler:h?M(h)?g=>h.parse(g.value):h:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:_nullishCoalesce(_optionalChain([e, 'access', _2 => _2.validationEvents, 'optionalAccess', _3 => _3.blur]), () => (!0))},change:{failedAttempts:0,passedAttempts:0,isActive:_nullishCoalesce(_optionalChain([e, 'access', _4 => _4.validationEvents, 'optionalAccess', _5 => _5.change]), () => (!1))},submit:{failedAttempts:0,passedAttempts:0,isActive:_nullishCoalesce(_optionalChain([e, 'access', _6 => _6.validationEvents, 'optionalAccess', _7 => _7.submit]), () => (!0))}},currentEvent:null,isDirty:!1,metadata:{name:v}},e.validationEvents&&(t=!0,o={...o,...e.validationEvents}),t)for(u in o)f[v].events[u].isActive=!!typeof o[u]}return f}function Z(e,a,o){let t={};for(let u of o.fieldsNames)t[u]=new b({value:e.initialValues[u],valueFromFieldToStore:_optionalChain([e, 'access', _8 => _8.valuesFromFieldsToStore, 'optionalAccess', _9 => _9[u]])?e.valuesFromFieldsToStore[u]:void 0,valueFromStoreToField:_optionalChain([e, 'access', _10 => _10.valuesFromStoreToFields, 'optionalAccess', _11 => _11[u]])?e.valuesFromStoreToFields[u]:void 0,id:`${a}field-${String(u)}`,metadata:{name:u,initialValue:e.initialValues[u]}});return t}function E(e){return function(a){if(!a.validations[e.name].events[e.validationEvent].isActive)return a;let o=a.currentDirtyFieldsCounter,t={...a.validations[e.name]};return t.currentEvent=e.validationEvent,e.message?(t.failedAttempts++,t.events[e.validationEvent].failedAttempts++,t.isDirty||(t.currentDirtyEventsCounter++,t.currentDirtyEventsCounter>0&&o++),t.error={message:e.message},t.isDirty=!0):(t.passedAttempts++,t.events[e.validationEvent].passedAttempts++,t.isDirty&&(t.currentDirtyEventsCounter--,t.currentDirtyEventsCounter===0&&o--),t.error=null,t.isDirty=!1),a.currentDirtyFieldsCounter=o,a.isDirty=o>0,a.validations={...a.validations,[e.name]:t},a}}function K(e,a){return function(o){let t=o.fields[e];return t.value=typeof a=="function"?a(t.value):a,{...o,fields:{...o.fields,[e]:t}}}}var L={fields:!0,validations:!0,submit:!1,focus:!0};function j(e,a,o){let t=()=>{let i=a(),n={},l;for(l in i.fields)n[l]=i.fields[l].value;return n},u=i=>a().fields[i].value,f=i=>{e(function(n){return{submit:{...n.submit,...typeof i=="function"?i(n.submit):i}}})},v=(i,n,l)=>{e(function(s){let r=s;if(!l&&r.validations[n].events.blur.isActive){try{r.validations[n].handler({value:n&&i!==n?r.getValues():r.fields[i].value,name:i,get:a,validationEvent:"blur",...r._baseMethods}),r=E({name:n,message:null,validationEvent:"blur"})(r)}catch(S){let V=r.errorFormatter(S,"blur");r=E({name:n,message:V,validationEvent:"blur"})(r)}if(r.focus.isActive&&r.focus.field.name!==i)return r}return{...r,focus:l?{isActive:!0,field:{name:i,id:r.fields[i].id}}:{isActive:!1,field:null}}})},h=(i=L)=>e(function(n){let l=n.fields,s=n.validations,r=n.isDirty,S=n.submit,V=n.focus;if(i.fields){let d;for(d in l)l[d].value=l[d].metadata.initialValue}if(i.validations){for(let d in s){s[d].failedAttempts=0,s[d].passedAttempts=0,s[d].currentEvent=null,s[d].isDirty=!1,s[d].error=null;let c;for(c in s[d].events)s[d].events[c].isActive=!1,s[d].events[c].failedAttempts=0,s[d].events[c].passedAttempts=0}r=!1}return i.submit&&(S={counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1}),i.focus&&(V={isActive:!1,field:null}),{fields:l,validations:s,isDirty:r,submit:S,focus:V}}),g=(i,n)=>e(K(i,n)),C=i=>{e(E(i))},w=_nullishCoalesce(o.errorFormatter, () => (N));return{getValues:t,errorFormatter:w,getValue:u,setSubmitState:f,setFocusState:v,resetFormStore:h,setFieldValue:g,setFieldError:C,handleInputChange:(i,n,l)=>{let s=a(),r=s.fields[i],S=typeof n=="function"?n(r.value):n,V=r.valueFromFieldToStore?r.valueFromFieldToStore(S):S,d=l||(s.metadata.referencedValidatedFieldsMap[i]?i:void 0),c=K,p=E;if(d&&s.validations[d].events.change.isActive)try{s=c(i,s.validations[d].handler({value:l&&l!==i?s.getValues():V,name:i,get:a,validationEvent:"change",...s._baseMethods}))(s),s=p({name:d,message:null,validationEvent:"change"})(s)}catch(F){s=p({name:d,message:s.errorFormatter(F,"change"),validationEvent:"change"})(s),s=c(i,V)(s)}else s=c(i,V)(s);e(s)},getFieldEventsListeners:(i,n)=>{let l=a(),s=_nullishCoalesce(n, () => (i));return{onChange:r=>{l.handleInputChange(i,r.target.value)},onFocus:()=>{l.setFocusState(i,s,!0)},onBlur:()=>{l.setFocusState(i,s,!1)}}},handleSubmit:i=>async function(n){n.preventDefault();let l=a();l.setSubmitState({isActive:!0});let s=l.metadata,r=l.fields,S=l.validations,V={},d={},c={},p=!1,F;for(F in r){V[F]=r[F].value;try{let m=F in s.referencedValidatedFieldsMap&&S[F].handler;if(typeof m!="function"||!S[F].events.submit.isActive)continue;d[F]=m({value:r[F].value,name:F,get:a,validationEvent:"submit",...l._baseMethods}),c[F]={name:F,message:null,validationEvent:"submit"}}catch(m){c[F]={name:F,message:l.errorFormatter(m,"submit"),validationEvent:"submit"}}}let y;for(y of s.manualValidatedFields)try{let m=l.validations[y].handler;if(typeof m!="function")continue;d[y]=m({value:void 0,name:void 0,get:a,validationEvent:"submit",...l._baseMethods}),c[y]={name:y,message:null,validationEvent:"submit"}}catch(m){c[y]={name:y,message:l.errorFormatter(m,"submit"),validationEvent:"submit"}}let k=a(),x;for(x in c){let m=c[x];k=E(c[x])(k),typeof m.message=="string"&&(p=!0)}if(p)e(k),l.setSubmitState(m=>({isActive:!1,counter:m.counter+1,failedAttempts:m.counter+1,errorMessage:null}));else try{await i({event:n,values:V,validatedValues:d,hasError:p,errors:c}),l.setSubmitState(m=>({isActive:!1,counter:m.counter+1,passedAttempts:m.counter+1,errorMessage:null}))}catch(m){l.setSubmitState(A=>({isActive:!1,counter:A.counter+1,failedAttempts:A.counter+1,errorMessage:l.errorFormatter(m,"submit")}))}}}}function T(e){return(a,o)=>{let t=j(a,o,e),u=e.baseId?`${e.baseId}-`:"",f=R(e,u),v=Z(e,u,f),h=G(e,f);return{baseId:u,metadata:f,validations:h,fields:v,id:`${u}form`,isDirty:!1,submit:{counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1},focus:{isActive:!1,field:null},currentDirtyFieldsCounter:0,_baseMethods:t,...t}}}exports.createFormStoreBuilder = T; exports.errorFormatter = N; exports.fvh = _chunkCUZ5GBXNjs.e; exports.handleCreateFormStore = H; exports.isZodError = D; exports.isZodValidator = M; exports.useCreateFormStore = U;
//# sourceMappingURL=index.js.map