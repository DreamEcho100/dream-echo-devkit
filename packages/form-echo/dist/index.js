"use strict";var D=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var P=(e,r)=>{for(var t in r)D(e,t,{get:r[t],enumerable:!0})},O=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of x(r))!$.call(e,l)&&l!==t&&D(e,l,{get:()=>r[l],enumerable:!(o=I(r,l))||o.enumerable});return e};var j=e=>O(D({},"__esModule",{value:!0}),e);var R={};P(R,{createFormStoreBuilder:()=>N,errorFormatter:()=>h,formatDate:()=>C,getFirstDateOfWeek:()=>w,getWeekNumber:()=>k,handleCreateFormStore:()=>A,inputDateHelpers:()=>Z,isZodError:()=>H,isZodValidator:()=>E,parseDate:()=>M,useCreateFormStore:()=>G});module.exports=j(R);function E(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function H(e){return e instanceof Object&&"errors"in e}function h(e){return H(e)?e.format()._errors.join(", "):e instanceof Error?e.message:"Something went wrong!"}function C(e,r){let t="";switch(r){case"date":t=e.toISOString().slice(0,10);break;case"time":t=e.toTimeString().slice(0,8);break;case"datetime-local":t=`${e.getFullYear()}-${`${e.getMonth()+1}`.padStart(2,"0")}-${`${e.getDate()}`.padStart(2,"0")}T${`${e.getHours()}`.padStart(2,"0")}:${`${e.getMinutes()}`.padStart(2,"0")}`;break;case"week":let o=e.getFullYear(),l=k(e);t=`${o}-W${l.toString().length<2?"0"+l.toString():l.toString()}`;break;case"month":t=e.toISOString().slice(0,7);break;default:break}return t}function M(e,r){let t;switch(r){case"date":t=new Date(e);break;case"time":let[o,l,d]=e.toString().split(":");t=new Date,t.setHours(Number(o||0)),t.setMinutes(Number(l||0)),t.setSeconds(Number(d||0));break;case"datetime-local":t=new Date(e.toString().replace(" ","T"));break;case"week":let[m,i]=e.toString().split("-W"),s=Number(m),n=Number(i);t=w(s,n);break;case"month":t=new Date(`${e}-01`);break;default:t=new Date;break}return t}function k(e){let r=new Date(e.getFullYear(),0,1),t=(e.valueOf()-r.valueOf())/(1e3*60*60*24);return Math.floor(t/7)+1}function w(e,r){let t=new Date(e,0,1),o=(8-t.getDay())%7,l=new Date(t);l.setDate(t.getDate()+o);let d=(r-1)*7,m=new Date(l);return m.setDate(l.getDate()+d),m}var Z={formatDate:C,parseDate:M,getWeekNumber:k,getFirstDateOfWeek:w};var T=require("zustand");var S=require("react"),A=e=>(0,T.createStore)(N(e)),G=e=>{let r=(0,S.useId)();return(0,S.useState)(A({...e,baseId:e.baseId||r}))[0]};function K(e,r){if(!e.initValues||typeof e.initValues!="object")throw new Error("");let t={baseId:r,formId:`${r}_form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};t.fieldsNames=Object.keys(e.initValues);for(let o of t.fieldsNames)t.fieldsNamesMap[o]=!0;for(let o in e.validationsSchema){if(t.validatedFieldsNames.push(o),t.validatedFieldsNamesMap[o]=!0,o in t.fieldsNamesMap){t.referencedValidatedFields.push(o),t.referencedValidatedFieldsMap[o]=!0;continue}t.manualValidatedFields.push(o),t.manualValidatedFieldsMap[o]=!0}return t}function B(e,r){let t={submit:!0},o=!1,l,d={};for(let m of r.validatedFieldsNames){let i=e.validationsSchema?.[m];if(d[m]={handler:i?E(i)?s=>i.parse(s):i:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{change:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null},submit:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null}},isDirty:!1,metadata:{name:m}},e.validationEvents&&(o=!0,t={...t,...e.validationEvents}),o)for(l in t)d[m].events[l].isActive=!!typeof t[l]}return d}function W(e,r,t){let o=e.isUpdatingFieldsValueOnError??!0,l={};for(let d of t.fieldsNames)l[d]={value:e.initValues[d],isUpdatingValueOnError:o,valueFromFieldToStore:e.valuesFromFieldsToStore?.[d]?e.valuesFromFieldsToStore[d]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[d]?e.valuesFromStoreToFields[d]:void 0,errors:null,isDirty:!1,id:`${r}field-${String(d)}`,metadata:{name:d,initialValue:e.initValues[d]}};return l}var Y={fields:!0,validations:!0,submitCounter:!1};function N(e){let r=e.baseId?`${e.baseId}-`:"",t=K(e,r),o=W(e,r,t),l=B(e,t);return(d,m)=>({baseId:r,metadata:t,validations:l,fields:o,id:`${r}-form`,isDirty:!1,isSubmitting:!1,submitCounter:0,currentDirtyFieldsCounter:0,utils:{setIsSubmitting(i){d(function(s){return{...s,isSubmitting:typeof i=="function"?i(s.isSubmitting):i}})},resetFormStore:function(i=Y){return d(function(s){let n=s.fields,a=s.validations,f=s.isDirty,y=s.submitCounter;if(i.fields)for(let u in n)n[u].value=n[u].metadata.initialValue;if(i.validations){for(let u in a){a[u].failedAttempts=0,a[u].passedAttempts=0,a[u].isDirty=!1;let F;for(F in a[u].events)a[u].events[F].failedAttempts=0,a[u].events[F].passedAttempts=0,a[u].events[F].isDirty=!1,a[u].events[F].message=null}f=!1}return i.submitCounter&&(y=0),{...s,fields:n,validations:a,isDirty:f,submitCounter:y}})},setFieldValue(i,s){return d(function(n){return{fields:{...n.fields,[i]:{...n.fields[i],value:typeof s=="function"?s(n.fields[i].value):s}}}})},setFieldErrors(i){d(function(s){if(!s.validations[i.name].events[i.validationEvent].isActive)return s;let n=s.currentDirtyFieldsCounter,a=s.validations[i.name],f=!!i.error;return f?(a.failedAttempts++,a.events[i.validationEvent].isDirty||(a.currentDirtyEventsCounter++,!a.isDirty&&a.currentDirtyEventsCounter>0&&n++),a.events[i.validationEvent].message=i.error,a.events[i.validationEvent].isDirty=f,a.events[i.validationEvent].failedAttempts++):(a.passedAttempts++,a.events[i.validationEvent].isDirty&&(a.currentDirtyEventsCounter--,a.isDirty&&a.currentDirtyEventsCounter===0&&n--),a.events[i.validationEvent].message=i.error,a.events[i.validationEvent].isDirty=f,a.events[i.validationEvent].passedAttempts++),a.isDirty=a.currentDirtyEventsCounter>0,{...s,currentDirtyFieldsCounter:n,isDirty:n>0,validations:{...s.validations,[i.name]:a}}})},errorFormatter:e.errorFormatter??h,handleOnInputChange(i,s,n){let a=m(),f=a.fields[i],y=typeof s=="function"?s(f.value):f.valueFromFieldToStore?f.valueFromFieldToStore(s):s,u=n||(a.metadata.referencedValidatedFieldsMap[i]?i:void 0);if(u&&a.validations[u].events.change.isActive)try{a.utils.setFieldValue(i,a.validations[u].handler(y,"change")),a.utils.setFieldErrors({name:u,error:null,validationEvent:"change"})}catch(F){a.utils.setFieldErrors({name:u,error:a.utils.errorFormatter(F,"change"),validationEvent:"change"}),f.isUpdatingValueOnError&&a.utils.setFieldValue(i,y)}else a.utils.setFieldValue(i,y)},handleSubmit(i){return async function(s){s.preventDefault();let n=m();n.utils.setIsSubmitting(!0);let a=n.metadata,f=n.fields,y=n.validations,u={},F={},p={},b=!1,c;for(c in f){u[c]=f[c].value;try{let v=c in a.referencedValidatedFieldsMap&&y[c].handler;y[c].events.submit.isActive&&typeof v=="function"&&(F[c]=v(f[c].value,"submit")),p[c]={name:c,error:null,validationEvent:"submit"}}catch(v){p[c]={name:c,error:n.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}}let V;for(V of a.manualValidatedFields)try{let v=n.validations[V].handler;typeof v=="function"&&(F[V]=v(u,"submit")),p[V]={name:V,error:null,validationEvent:"submit"}}catch(v){p[V]={name:V,error:n.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}let g;for(g in p){let v=p[g];n.utils.setFieldErrors(p[g]),typeof v.error=="string"&&(b=!0)}n.utils.setIsSubmitting(!1),!b&&await i({event:s,values:u,validatedValues:F,hasError:b,errors:p})}}}})}0&&(module.exports={createFormStoreBuilder,errorFormatter,formatDate,getFirstDateOfWeek,getWeekNumber,handleCreateFormStore,inputDateHelpers,isZodError,isZodValidator,parseDate,useCreateFormStore});
//# sourceMappingURL=index.js.map