"use strict";var A=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var R=(i,o)=>{for(var s in o)A(i,s,{get:o[s],enumerable:!0})},Z=(i,o,s,c)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of j(o))!M.call(i,n)&&n!==s&&A(i,n,{get:()=>o[n],enumerable:!(c=H(o,n))||c.enumerable});return i};var U=i=>Z(A({},"__esModule",{value:!0}),i);var J={};R(J,{handleCreateFormStore:()=>P,inputDateHelpers:()=>C,useCreateFormStore:()=>G});module.exports=U(J);function K(i,o){let s="";switch(o){case"date":s=i.toISOString().slice(0,10);break;case"time":s=i.toTimeString().slice(0,8);break;case"datetime-local":s=i.toISOString().slice(0,16),s=s.replace("T"," ");break;case"week":let c=i.getFullYear(),n=O(i);s=`${c}-W${n.toString().length<2?"0"+n.toString():n.toString()}`;break;case"month":s=i.toISOString().slice(0,7);break;default:break}return s}function W(i,o){let s;switch(o){case"date":s=new Date(i);break;case"time":let[c,n,u]=i.toString().split(":");s=new Date,s.setHours(Number(c)),s.setMinutes(Number(n)),s.setSeconds(Number(u));break;case"datetime-local":s=new Date(i.toString().replace(" ","T"));break;case"week":let[y,S]=i.toString().split("-W"),h=Number(y),g=Number(S);s=T(h,g);break;case"month":s=new Date(`${i}-01`);break;default:s=new Date;break}return s}function O(i){let o=new Date(i.getFullYear(),0,1),s=(i.valueOf()-o.valueOf())/(1e3*60*60*24);return Math.floor(s/7)+1}function T(i,o){let s=new Date(i,0,1),c=(8-s.getDay())%7,n=new Date(s);n.setDate(s.getDate()+c);let u=(o-1)*7,y=new Date(n);return y.setDate(n.getDate()+u),y}var Y={formatDate:K,parseDate:W,getWeekNumber:O,getFirstDateOfWeek:T},C=Y;var $=require("zustand"),x=require("react"),z=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{let o=Math.random()*16|0;return(i==="x"?o:o&3|8).toString(16)}),q=i=>i instanceof Object&&"parseAsync"in i&&typeof i.parseAsync=="function",B=i=>i instanceof Object&&"errors"in i,P=({isUpdatingFieldsValueOnError:i=!0,trackValidationHistory:o=!1,valuesFromFieldsToStore:s,valuesFromStoreToFields:c,validationSchema:n,...u})=>{if(!u.initValues||typeof u.initValues!="object")throw new Error("");let y=typeof u.baseId=="boolean"?z():u.baseId?`${u.baseId}-`:"",S={},h={fieldsNames:Object.keys(u.initValues),formId:`${y}form`},g=0,b={},w,D,V={submit:!0},N=!1,E;for(let d of h.fieldsNames){let v=n?.[d];if(D={handler:v?q(v)?e=>v.parse(e):v:void 0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:!1},change:{failedAttempts:0,passedAttempts:0,isActive:!1},mount:{failedAttempts:0,passedAttempts:0,isActive:!1},submit:{failedAttempts:0,passedAttempts:0,isActive:!1}}},w=u.initValues[d],u.validationEvents&&(N=!0,V={...V,...u.validationEvents}),b[d]={value:w,isUpdatingValueOnError:i,valueFromFieldToStore:s?.[d]?s[d]:void 0,valueFromStoreToField:c?.[d]?c[d]:void 0},N)for(E in V)D.events[E].isActive=!!typeof V[E];b[d]={...b[d],errors:null,isDirty:!1,metadata:{id:`${y}field-${String(d)}`,name:d,initialValue:b[d].value},validation:D}}return(0,$.createStore)((d,v)=>({fields:b,errors:S,metadata:h,submitCounter:g,isTrackingValidationHistory:o,validations:{history:[]},utils:{handleOnInputChange:(e,a)=>{let r=v(),t=r.utils.handleFieldValidation({name:e,value:a,validationEvent:"change"});r.utils.setFieldValue(e,t)},errorFormatter:e=>B(e)?e.format()._errors:e instanceof Error?[e.message]:["Something went wrong!"],reInitFieldsValues:()=>d(e=>{let a=e.metadata.fieldsNames,r=e.fields,t;for(t of a)r[t]={...r[t],value:r[t].metadata.initialValue};return{fields:r}}),setFieldValue:(e,a)=>d(r=>({fields:{...r.fields,[e]:{...r.fields[e],value:typeof a=="function"?a(r.fields[e].value):a}}})),setFieldErrors:e=>d(a=>{let r=!!e.errors,t=a.fields[e.name];return t={...t,isDirty:r,errors:e.errors,validation:{...t.validation,events:{...t.validation.events,[e.validationEvent]:{...t.validation.events[e.validationEvent],failedAttempts:r?t.validation.events[e.validationEvent].failedAttempts:t.validation.events[e.validationEvent].failedAttempts+1,passedAttempts:r?t.validation.events[e.validationEvent].passedAttempts:t.validation.events[e.validationEvent].passedAttempts+1}}}},{fields:{...a.fields,[e.name]:t},errors:S}}),createValidationHistoryRecord:({fields:e,validationEvent:a,validationEventPhase:r,validationEventState:t})=>{let m=[];r==="start"&&m.push(`Starting the validation for fields: [${Object.keys(e).join(", ")}]`),r==="end"&&m.push(`Ending the validation for fields: [${Object.keys(e).join(", ")}]`),m.push(`Validation ${t[0].toUpperCase()+t.slice(1)}!`),e.forEach(p=>{m.push(`Field: ${String(p.metadata.name)}, Failed Attempts: ${p.validation.events[a].failedAttempts}, Passed Attempt: ${p.validation.events[a].passedAttempts}`)})},handleFieldValidation:({name:e,validationEvent:a,value:r})=>{let t=v(),m=typeof r=="function"?r(t.fields[e].value):r;if(!t.fields[e].validation.events[a].isActive)return m;let p=t.fields[e].validation.handler;if(!p)return m;t.fields[e].valueFromFieldToStore;let f=t.fields[e].valueFromFieldToStore?t.fields[e].valueFromFieldToStore(m):m,F=l=>(t.utils.setFieldErrors({name:e,errors:t.utils.errorFormatter(l,a),validationEvent:a}),t.fields[e].isUpdatingValueOnError?f:t.fields[e].value);if(t.isTrackingValidationHistory)try{t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:a,validationEventPhase:"start",validationEventState:"processing"}),f=p(f,a),t.fields[e].isDirty&&t.utils.setFieldErrors({name:e,errors:null,validationEvent:a}),t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:a,validationEventPhase:"end",validationEventState:"passed"})}catch(l){f=F(l),t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:a,validationEventPhase:"end",validationEventState:"failed"})}else try{f=p(f,a),t.fields[e].isDirty&&t.utils.setFieldErrors({name:e,errors:null,validationEvent:a})}catch(l){f=F(l)}return f},handlePreSubmit:e=>a=>{if(a.preventDefault(),!e)return;let r=v(),t=r.fields,m={},p={},f={},F=!1,l;for(l in t)try{let k=t[l].validation.handler;t[l].validation.events.submit.isActive&&typeof k=="function"&&(p[l]=k(t[l].value,"submit")),m[l]=t[l].value,f[l]={name:l,errors:null,validationEvent:"submit"}}catch(k){f[l]={name:l,errors:r.utils.errorFormatter(k,"submit"),validationEvent:"submit"},F=!0}let I;for(I in f)r.utils.setFieldErrors(f[I]);F||e(a,{values:m,validatedValues:p,hasError:F,errors:f})}}}))},G=i=>{let o=(0,x.useId)();return(0,x.useRef)(P({...i,baseId:i.baseId||o})).current};0&&(module.exports={handleCreateFormStore,inputDateHelpers,useCreateFormStore});
//# sourceMappingURL=index.js.map