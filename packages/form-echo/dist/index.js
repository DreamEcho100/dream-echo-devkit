"use strict";var D=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var P=(e,i)=>{for(var t in i)D(e,t,{get:i[t],enumerable:!0})},O=(e,i,t,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let l of x(i))!$.call(e,l)&&l!==t&&D(e,l,{get:()=>i[l],enumerable:!(o=I(i,l))||o.enumerable});return e};var j=e=>O(D({},"__esModule",{value:!0}),e);var R={};P(R,{createFormStoreBuilder:()=>N,errorFormatter:()=>E,formatDate:()=>C,getFirstDateOfWeek:()=>w,getWeekNumber:()=>h,handleCreateFormStore:()=>A,inputDateHelpers:()=>Z,isZodError:()=>H,isZodValidator:()=>k,parseDate:()=>M,useCreateFormStore:()=>G});module.exports=j(R);function k(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function H(e){return e instanceof Object&&"errors"in e}function E(e){return H(e)?e.format()._errors.join(", "):e instanceof Error?e.message:"Something went wrong!"}function C(e,i){let t="";switch(i){case"date":t=e.toISOString().slice(0,10);break;case"time":t=e.toTimeString().slice(0,8);break;case"datetime-local":t=`${e.getFullYear()}-${`${e.getMonth()+1}`.padStart(2,"0")}-${`${e.getDate()}`.padStart(2,"0")}T${`${e.getHours()}`.padStart(2,"0")}:${`${e.getMinutes()}`.padStart(2,"0")}`;break;case"week":let o=e.getFullYear(),l=h(e);t=`${o}-W${l.toString().length<2?"0"+l.toString():l.toString()}`;break;case"month":t=e.toISOString().slice(0,7);break;default:break}return t}function M(e,i){let t;switch(i){case"date":t=new Date(e);break;case"time":let[o,l,u]=e.toString().split(":");t=new Date,t.setHours(Number(o||0)),t.setMinutes(Number(l||0)),t.setSeconds(Number(u||0));break;case"datetime-local":t=new Date(e.toString().replace(" ","T"));break;case"week":let[m,s]=e.toString().split("-W"),r=Number(m),n=Number(s);t=w(r,n);break;case"month":t=new Date(`${e}-01`);break;default:t=new Date;break}return t}function h(e){let i=new Date(e.getFullYear(),0,1),t=(e.valueOf()-i.valueOf())/(1e3*60*60*24);return Math.floor(t/7)+1}function w(e,i){let t=new Date(e,0,1),o=(8-t.getDay())%7,l=new Date(t);l.setDate(t.getDate()+o);let u=(i-1)*7,m=new Date(l);return m.setDate(l.getDate()+u),m}var Z={formatDate:C,parseDate:M,getWeekNumber:h,getFirstDateOfWeek:w};var T=require("zustand");var S=require("react"),A=e=>(0,T.createStore)(N(e)),G=e=>{let i=(0,S.useId)();return(0,S.useState)(A({...e,baseId:e.baseId||i}))[0]};function K(e,i){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let t={baseId:i,formId:`${i}_form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};t.fieldsNames=Object.keys(e.initialValues);for(let o of t.fieldsNames)t.fieldsNamesMap[o]=!0;for(let o in e.validationsHandlers){if(t.validatedFieldsNames.push(o),t.validatedFieldsNamesMap[o]=!0,o in t.fieldsNamesMap){t.referencedValidatedFields.push(o),t.referencedValidatedFieldsMap[o]=!0;continue}t.manualValidatedFields.push(o),t.manualValidatedFieldsMap[o]=!0}return t}function B(e,i){let t={submit:!0},o=!1,l,u={};for(let m of i.validatedFieldsNames){let s=e.validationsHandlers?.[m];if(u[m]={handler:s?k(s)?r=>s.parse(r):s:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{change:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,error:null},submit:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,error:null}},isDirty:!1,metadata:{name:m}},e.validationEvents&&(o=!0,t={...t,...e.validationEvents}),o)for(l in t)u[m].events[l].isActive=!!typeof t[l]}return u}function W(e,i,t){let o=e.isUpdatingFieldsValueOnError??!0,l={};for(let u of t.fieldsNames)l[u]={value:e.initialValues[u],isUpdatingValueOnError:o,valueFromFieldToStore:e.valuesFromFieldsToStore?.[u]?e.valuesFromFieldsToStore[u]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[u]?e.valuesFromStoreToFields[u]:void 0,id:`${i}field-${String(u)}`,metadata:{name:u,initialValue:e.initialValues[u]}};return l}var Y={fields:!0,validations:!0,submitCounter:!1};function N(e){let i=e.baseId?`${e.baseId}-`:"",t=K(e,i),o=W(e,i,t),l=B(e,t);return(u,m)=>({baseId:i,metadata:t,validations:l,fields:o,id:`${i}-form`,isDirty:!1,isSubmitting:!1,submitCounter:0,currentDirtyFieldsCounter:0,utils:{setIsSubmitting(s){u(function(r){return{...r,isSubmitting:typeof s=="function"?s(r.isSubmitting):s}})},resetFormStore:function(s=Y){return u(function(r){let n=r.fields,a=r.validations,c=r.isDirty,p=r.submitCounter;if(s.fields){let d;for(d in n)n[d].value=n[d].metadata.initialValue}if(s.validations){for(let d in a){a[d].failedAttempts=0,a[d].passedAttempts=0,a[d].isDirty=!1,a[d].error=null;let F;for(F in a[d].events)a[d].events[F].failedAttempts=0,a[d].events[F].passedAttempts=0,a[d].events[F].isDirty=!1,a[d].events[F].error=null}c=!1}return s.submitCounter&&(p=0),{...r,fields:n,validations:a,isDirty:c,submitCounter:p}})},setFieldValue(s,r){return u(function(n){return{fields:{...n.fields,[s]:{...n.fields[s],value:typeof r=="function"?r(n.fields[s].value):r}}}})},setFieldErrors(s){u(function(r){if(!r.validations[s.name].events[s.validationEvent].isActive)return r;let n=r.currentDirtyFieldsCounter,a=r.validations[s.name];return s.message?(a.failedAttempts++,a.events[s.validationEvent].failedAttempts++,a.isDirty||(a.currentDirtyEventsCounter++,a.currentDirtyEventsCounter>0&&n++),a.events[s.validationEvent].error={message:s.message},a.error={message:s.message},a.events[s.validationEvent].isDirty=!0,a.isDirty=!0):(a.passedAttempts++,a.events[s.validationEvent].passedAttempts++,a.isDirty&&(a.currentDirtyEventsCounter--,a.currentDirtyEventsCounter===0&&n--),a.events[s.validationEvent].error=null,a.error=null,a.events[s.validationEvent].isDirty=!1,a.isDirty=!1),{...r,currentDirtyFieldsCounter:n,isDirty:n>0,validations:{...r.validations,[s.name]:a}}})},errorFormatter:e.errorFormatter??E,handleOnInputChange(s,r,n){let a=m(),c=a.fields[s],p=typeof r=="function"?r(c.value):c.valueFromFieldToStore?c.valueFromFieldToStore(r):r,d=n||(a.metadata.referencedValidatedFieldsMap[s]?s:void 0);if(d&&a.validations[d].events.change.isActive)try{a.utils.setFieldValue(s,a.validations[d].handler(p,"change")),a.utils.setFieldErrors({name:d,message:null,validationEvent:"change"})}catch(F){a.utils.setFieldErrors({name:d,message:a.utils.errorFormatter(F,"change"),validationEvent:"change"}),c.isUpdatingValueOnError&&a.utils.setFieldValue(s,p)}else a.utils.setFieldValue(s,p)},handleSubmit(s){return async function(r){r.preventDefault();let n=m();n.utils.setIsSubmitting(!0);let a=n.metadata,c=n.fields,p=n.validations,d={},F={},y={},g=!1,f;for(f in c){d[f]=c[f].value;try{let v=f in a.referencedValidatedFieldsMap&&p[f].handler;if(typeof v!="function"||!p[f].events.submit.isActive)continue;F[f]=v(c[f].value,"submit"),y[f]={name:f,message:null,validationEvent:"submit"}}catch(v){y[f]={name:f,message:n.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}}let V;for(V of a.manualValidatedFields)try{let v=n.validations[V].handler;if(typeof v!="function")continue;F[V]=v(d,"submit"),y[V]={name:V,message:null,validationEvent:"submit"}}catch(v){y[V]={name:V,message:n.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}let b;for(b in y){let v=y[b];n.utils.setFieldErrors(y[b]),typeof v.message=="string"&&(g=!0)}n.utils.setIsSubmitting(!1),!g&&await s({event:r,values:d,validatedValues:F,hasError:g,errors:y})}}}})}0&&(module.exports={createFormStoreBuilder,errorFormatter,formatDate,getFirstDateOfWeek,getWeekNumber,handleCreateFormStore,inputDateHelpers,isZodError,isZodValidator,parseDate,useCreateFormStore});
//# sourceMappingURL=index.js.map