"use strict";var D=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var B=(e,a)=>{for(var t in a)D(e,t,{get:a[t],enumerable:!0})},G=(e,a,t,s)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of Z(a))!O.call(e,n)&&n!==t&&D(e,n,{get:()=>a[n],enumerable:!(s=j(a,n))||s.enumerable});return e};var K=e=>G(D({},"__esModule",{value:!0}),e);var J={};B(J,{createFormStoreBuilder:()=>T,errorFormatter:()=>A,formatDate:()=>x,getFirstDateOfWeek:()=>N,getWeekNumber:()=>w,handleCreateFormStore:()=>P,inputDateHelpers:()=>W,isZodError:()=>C,isZodValidator:()=>H,parseDate:()=>I,useCreateFormStore:()=>Y});module.exports=K(J);var b=class{id;value;metadata;valueFromFieldToStore;valueFromStoreToField;constructor(a){this.id=a.id,this.value=a.value,this.metadata=a.metadata,this.valueFromFieldToStore=a.valueFromFieldToStore,this.valueFromStoreToField=a.valueFromStoreToField??(()=>this.value)}get storeToFieldValue(){return this.valueFromStoreToField(this.value)}};function H(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function C(e){return e instanceof Object&&"errors"in e}function A(e){return C(e)?e.format()._errors.join(", "):e instanceof Error?e.message:"Something went wrong!"}function x(e,a){let t="";switch(a){case"date":t=e.toISOString().slice(0,10);break;case"time":t=e.toTimeString().slice(0,8);break;case"datetime-local":t=`${e.getFullYear()}-${`${e.getMonth()+1}`.padStart(2,"0")}-${`${e.getDate()}`.padStart(2,"0")}T${`${e.getHours()}`.padStart(2,"0")}:${`${e.getMinutes()}`.padStart(2,"0")}`;break;case"week":let s=e.getFullYear(),n=w(e);t=`${s}-W${n.toString().length<2?"0"+n.toString():n.toString()}`;break;case"month":t=e.toISOString().slice(0,7);break;default:break}return t}function I(e,a){let t;switch(a){case"date":t=new Date(e);break;case"time":let[s,n,c]=e.toString().split(":");t=new Date,t.setHours(Number(s||0)),t.setMinutes(Number(n||0)),t.setSeconds(Number(c||0));break;case"datetime-local":t=new Date(e.toString().replace(" ","T"));break;case"week":let[F,i]=e.toString().split("-W"),o=Number(F),l=Number(i);t=N(o,l);break;case"month":t=new Date(`${e}-01`);break;default:t=new Date;break}return t}function w(e){let a=new Date(e.getFullYear(),0,1),t=(e.valueOf()-a.valueOf())/(1e3*60*60*24);return Math.floor(t/7)+1}function N(e,a){let t=new Date(e,0,1),s=(8-t.getDay())%7,n=new Date(t);n.setDate(t.getDate()+s);let c=(a-1)*7,F=new Date(n);return F.setDate(n.getDate()+c),F}var W={formatDate:x,parseDate:I,getWeekNumber:w,getFirstDateOfWeek:N};var $=require("zustand");var h=require("react"),P=e=>(0,$.createStore)(T(e)),Y=e=>{let a=(0,h.useId)();return(0,h.useState)(P({...e,baseId:e.baseId||a}))[0]};function L(e,a){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let t={baseId:a,formId:`${a}-form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};t.fieldsNames=Object.keys(e.initialValues);for(let s of t.fieldsNames)t.fieldsNamesMap[s]=!0;for(let s in e.validationsHandlers){if(t.validatedFieldsNames.push(s),t.validatedFieldsNamesMap[s]=!0,s in t.fieldsNamesMap){t.referencedValidatedFields.push(s),t.referencedValidatedFieldsMap[s]=!0;continue}t.manualValidatedFields.push(s),t.manualValidatedFieldsMap[s]=!0}return t}function R(e,a){let t={submit:!0,blur:!0},s=!1,n,c={};for(let F of a.validatedFieldsNames){let i=e.validationsHandlers?.[F];if(c[F]={handler:i?H(i)?o=>i.parse(o):i:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.blur??!0,isDirty:!1,error:null},change:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.change??!1,isDirty:!1,error:null},submit:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.submit??!1,isDirty:!1,error:null}},isDirty:!1,metadata:{name:F}},e.validationEvents&&(s=!0,t={...t,...e.validationEvents}),s)for(n in t)c[F].events[n].isActive=!!typeof t[n]}return c}function q(e,a,t){let s={};for(let n of t.fieldsNames)s[n]=new b({value:e.initialValues[n],valueFromFieldToStore:e.valuesFromFieldsToStore?.[n]?e.valuesFromFieldsToStore[n]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[n]?e.valuesFromStoreToFields[n]:void 0,id:`${a}field-${String(n)}`,metadata:{name:n,initialValue:e.initialValues[n]}});return s}function g(e){return function(a){if(!a.validations[e.name].events[e.validationEvent].isActive)return a;let t=a.currentDirtyFieldsCounter,s={...a.validations[e.name]};return e.message?(s.failedAttempts++,s.events[e.validationEvent].failedAttempts++,s.isDirty||(s.currentDirtyEventsCounter++,s.currentDirtyEventsCounter>0&&t++),s.events[e.validationEvent].error={message:e.message},s.error={message:e.message},s.events[e.validationEvent].isDirty=!0,s.isDirty=!0):(s.passedAttempts++,s.events[e.validationEvent].passedAttempts++,s.isDirty&&(s.currentDirtyEventsCounter--,s.currentDirtyEventsCounter===0&&t--),s.events[e.validationEvent].error=null,s.error=null,s.events[e.validationEvent].isDirty=!1,s.isDirty=!1),a.currentDirtyFieldsCounter=t,a.isDirty=t>0,a.validations={...a.validations,[e.name]:s},a}}function _(e,a){return function(t){let s=t.fields[e];return s.value=typeof a=="function"?a(s.value):a,{...t,fields:{...t.fields,[e]:s}}}}var z={fields:!0,validations:!0,submit:!1,focus:!0};function T(e){let a=e.baseId?`${e.baseId}-`:"",t=L(e,a),s=q(e,a,t),n=R(e,t);return(c,F)=>({baseId:a,metadata:t,validations:n,fields:s,id:`${a}form`,isDirty:!1,submit:{counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1},focus:{isActive:!1,field:null},currentDirtyFieldsCounter:0,utils:{setSubmitState(i){c(function(o){return{submit:{...o.submit,...typeof i=="function"?i(o.submit):i}}})},setFocusState(i,o,l){c(function(r){let d=r;if(!l&&d.validations[o].events.blur.isActive){try{d.validations[o].handler(d.fields[i].value,"blur"),d=g({name:o,message:null,validationEvent:"blur"})(d)}catch(p){let y=d.utils.errorFormatter(p,"blur");d=g({name:o,message:y,validationEvent:"blur"})(d)}if(d.focus.isActive&&d.focus.field.name!==i)return d}return{...d,focus:l?{isActive:!0,field:{name:i,id:d.fields[i].id}}:{isActive:!1,field:null}}})},resetFormStore:function(i=z){return c(function(o){let l=o.fields,r=o.validations,d=o.isDirty,p=o.submit,y=o.focus;if(i.fields){let u;for(u in l)l[u].value=l[u].metadata.initialValue}if(i.validations){for(let u in r){r[u].failedAttempts=0,r[u].passedAttempts=0,r[u].isDirty=!1,r[u].error=null;let f;for(f in r[u].events)r[u].events[f].failedAttempts=0,r[u].events[f].passedAttempts=0,r[u].events[f].isDirty=!1,r[u].events[f].error=null}d=!1}return i.submit&&(p={counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1}),i.focus&&(y={isActive:!1,field:null}),{fields:l,validations:r,isDirty:d,submit:p,focus:y}})},setFieldValue(i,o){return c(_(i,o))},setFieldError(i){c(g(i))},errorFormatter:e.errorFormatter??A,handleOnInputChange(i,o,l){let r=F(),d=r.fields[i],p=typeof o=="function"?o(d.value):o,y=d.valueFromFieldToStore?d.valueFromFieldToStore(p):p,u=l||(r.metadata.referencedValidatedFieldsMap[i]?i:void 0),f=_,S=g;if(u&&r.validations[u].events.change.isActive)try{r=f(i,r.validations[u].handler(y,"change"))(r),r=S({name:u,message:null,validationEvent:"change"})(r)}catch(v){r=S({name:u,message:r.utils.errorFormatter(v,"change"),validationEvent:"change"})(r),r=f(i,y)(r)}else r=f(i,y)(r);c(r)},getFieldEventsListeners(i,o){let l=F(),r=o??i;return{onChange:d=>{l.utils.handleOnInputChange(i,d.target.value)},onFocus:()=>{l.utils.setFocusState(i,r,!0)},onBlur:()=>{l.utils.setFocusState(i,r,!1)}}},handleSubmit(i){return async function(o){o.preventDefault();let l=F();l.utils.setSubmitState({isActive:!0});let r=l.metadata,d=l.fields,p=l.validations,y={},u={},f={},S=!1,v;for(v in d){y[v]=d[v].value;try{let m=v in r.referencedValidatedFieldsMap&&p[v].handler;if(typeof m!="function"||!p[v].events.submit.isActive)continue;u[v]=m(d[v].value,"submit"),f[v]={name:v,message:null,validationEvent:"submit"}}catch(m){f[v]={name:v,message:l.utils.errorFormatter(m,"submit"),validationEvent:"submit"}}}let V;for(V of r.manualValidatedFields)try{let m=l.validations[V].handler;if(typeof m!="function")continue;u[V]=m(y,"submit"),f[V]={name:V,message:null,validationEvent:"submit"}}catch(m){f[V]={name:V,message:l.utils.errorFormatter(m,"submit"),validationEvent:"submit"}}let E=F(),k;for(k in f){let m=f[k];E=g(f[k])(E),typeof m.message=="string"&&(S=!0)}if(S)c(E),l.utils.setSubmitState(m=>({isActive:!1,counter:m.counter+1,failedAttempts:m.counter+1,errorMessage:null}));else try{await i({event:o,values:y,validatedValues:u,hasError:S,errors:f}),l.utils.setSubmitState(m=>({isActive:!1,counter:m.counter+1,passedAttempts:m.counter+1,errorMessage:null}))}catch(m){l.utils.setSubmitState(M=>({isActive:!1,counter:M.counter+1,failedAttempts:M.counter+1,errorMessage:l.utils.errorFormatter(m,"submit")}))}}}}})}0&&(module.exports={createFormStoreBuilder,errorFormatter,formatDate,getFirstDateOfWeek,getWeekNumber,handleCreateFormStore,inputDateHelpers,isZodError,isZodValidator,parseDate,useCreateFormStore});
//# sourceMappingURL=index.js.map