"use strict";var w=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var M=(s,o)=>{for(var a in o)w(s,a,{get:o[a],enumerable:!0})},U=(s,o,a,u)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of R(o))!j.call(s,n)&&n!==a&&w(s,n,{get:()=>o[n],enumerable:!(u=$(o,n))||u.enumerable});return s};var Z=s=>U(w({},"__esModule",{value:!0}),s);var J={};M(J,{handleCreateFormStore:()=>T,inputDateHelpers:()=>O,useCreateFormStore:()=>G});module.exports=Z(J);function K(s,o){let a="";switch(o){case"date":a=s.toISOString().slice(0,10);break;case"time":a=s.toTimeString().slice(0,8);break;case"datetime-local":a=s.toISOString().slice(0,16),a=a.replace("T"," ");break;case"week":let u=s.getFullYear(),n=I(s);a=`${u}-W${n.toString().length<2?"0"+n.toString():n.toString()}`;break;case"month":a=s.toISOString().slice(0,7);break;default:break}return a}function W(s,o){let a;switch(o){case"date":a=new Date(s);break;case"time":let[u,n,d]=s.toString().split(":");a=new Date,a.setHours(Number(u)),a.setMinutes(Number(n)),a.setSeconds(Number(d));break;case"datetime-local":a=new Date(s.toString().replace(" ","T"));break;case"week":let[F,g]=s.toString().split("-W"),S=Number(F),D=Number(g);a=H(S,D);break;case"month":a=new Date(`${s}-01`);break;default:a=new Date;break}return a}function I(s){let o=new Date(s.getFullYear(),0,1),a=(s.valueOf()-o.valueOf())/(1e3*60*60*24);return Math.floor(a/7)+1}function H(s,o){let a=new Date(s,0,1),u=(8-a.getDay())%7,n=new Date(a);n.setDate(a.getDate()+u);let d=(o-1)*7,F=new Date(n);return F.setDate(n.getDate()+d),F}var Y={formatDate:K,parseDate:W,getWeekNumber:I,getFirstDateOfWeek:H},O=Y;var C=require("zustand"),h=require("react"),z=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let o=Math.random()*16|0;return(s==="x"?o:o&3|8).toString(16)}),q=s=>s instanceof Object&&"parseAsync"in s&&typeof s.parseAsync=="function",B=s=>s instanceof Object&&"errors"in s,T=({isUpdatingFieldsValueOnError:s=!0,trackValidationHistory:o=!1,valuesFromFieldsToStore:a,valuesFromStoreToFields:u,validationHandler:n,...d})=>{if(!d.initValues||typeof d.initValues!="object")throw new Error("");let F=typeof d.baseId=="boolean"?z():d.baseId?`${d.baseId}-`:"",g={},S={fieldsNames:Object.keys(d.initValues),formId:`${F}form`},D=0,k={},A,P,x={submit:!0},N=!1,E;for(let l of S.fieldsNames){let v=n?.[l];if(P={handler:v?q(v)?e=>v.parse(e):v:void 0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:!1},change:{failedAttempts:0,passedAttempts:0,isActive:!1},mount:{failedAttempts:0,passedAttempts:0,isActive:!1},submit:{failedAttempts:0,passedAttempts:0,isActive:!1}}},A=d.initValues[l],d.validationEvents&&(N=!0,x={...x,...d.validationEvents}),k[l]={value:A,isUpdatingValueOnError:s,valueFromFieldToStore:a?.[l]?a[l]:void 0,valueFromStoreToField:u?.[l]?u[l]:void 0},N)for(E in x)P.events[E].isActive=!!typeof x[E];k[l]={...k[l],errors:null,isDirty:!1,metadata:{id:`${F}field-${String(l)}`,name:l,initialValue:k[l].value},validation:P}}return(0,C.createStore)((l,v)=>({fields:k,errors:g,metadata:S,submitCounter:D,isTrackingValidationHistory:o,validations:{history:[]},utils:{handleOnInputChange:(e,i)=>{let r=v(),t=r.utils.handleFieldValidation({name:e,value:i,validationEvent:"change"});r.utils.setFieldValue(e,t)},errorFormatter:e=>B(e)?e.format()._errors:e instanceof Error?[e.message]:["Something went wrong!"],reInitFieldsValues:()=>l(e=>{let i=e.metadata.fieldsNames,r=e.fields,t;for(t of i)r[t]={...r[t],value:r[t].metadata.initialValue};return{fields:r}}),setFieldValue:(e,i)=>l(r=>({fields:{...r.fields,[e]:{...r.fields[e],value:typeof i=="function"?i(r.fields[e].value):i}}})),setFieldErrors:e=>l(i=>{let r=!!e.errors,t=i.fields[e.name];return t={...t,isDirty:r,errors:e.errors,validation:{...t.validation,events:{...t.validation.events,[e.validationEvent]:{...t.validation.events[e.validationEvent],failedAttempts:r?t.validation.events[e.validationEvent].failedAttempts:t.validation.events[e.validationEvent].failedAttempts+1,passedAttempts:r?t.validation.events[e.validationEvent].passedAttempts:t.validation.events[e.validationEvent].passedAttempts+1}}}},{fields:{...i.fields,[e.name]:t},errors:g}}),createValidationHistoryRecord:({fields:e,validationEvent:i,validationEventPhase:r,validationEventState:t})=>{let c=[];r==="start"&&c.push(`Starting the validation for fields: [${Object.keys(e).join(", ")}]`),r==="end"&&c.push(`Ending the validation for fields: [${Object.keys(e).join(", ")}]`),c.push(`Validation ${t[0].toUpperCase()+t.slice(1)}!`),e.forEach(p=>{c.push(`Field: ${String(p.metadata.name)}, Failed Attempts: ${p.validation.events[i].failedAttempts}, Passed Attempt: ${p.validation.events[i].passedAttempts}`)})},handleFieldValidation:({name:e,validationEvent:i,value:r})=>{let t=v(),c=typeof r=="function"?r(t.fields[e].value):r;if(!t.fields[e].validation.events[i].isActive)return c;let p=t.fields[e].validation.handler;if(!p)return c;let b=t.fields[e].valueFromFieldToStore,m=b?b(c):c,f=t.fields[e].isUpdatingValueOnError,V=y=>(t.utils.setFieldErrors({name:e,errors:t.utils.errorFormatter(y,i),validationEvent:i}),f?m:t.fields[e].value);if(t.isTrackingValidationHistory)try{t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:i,validationEventPhase:"start",validationEventState:"processing"}),m=p(m,i),t.fields[e].isDirty&&t.utils.setFieldErrors({name:e,errors:null,validationEvent:i}),t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:i,validationEventPhase:"end",validationEventState:"passed"})}catch(y){m=V(y),t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:i,validationEventPhase:"end",validationEventState:"failed"})}else try{m=p(m,i),t.fields[e].isDirty&&t.utils.setFieldErrors({name:e,errors:null,validationEvent:i})}catch(y){m=V(y)}return m},handlePreSubmit:e=>i=>{if(i.preventDefault(),!e)return;let r=v(),t=r.fields,c={},p={},b={},m=!1,f;for(f in t)try{let y=t[f].validation.handler;t[f].validation.events.submit.isActive&&typeof y=="function"&&(p[f]=y(t[f].value,"submit")),c[f]=t[f].value,b[f]={name:f,errors:null,validationEvent:"submit"}}catch(y){b[f]={name:f,errors:r.utils.errorFormatter(y,"submit"),validationEvent:"submit"},m=!0}let V;for(V in b)r.utils.setFieldErrors(b[V]);m||e(i,{values:c,validatedValues:p,hasError:m,errors:b})}}}))},G=s=>{let o=(0,h.useId)();return(0,h.useRef)(T({...s,baseId:s.baseId||o})).current};0&&(module.exports={handleCreateFormStore,inputDateHelpers,useCreateFormStore});
//# sourceMappingURL=index.js.map