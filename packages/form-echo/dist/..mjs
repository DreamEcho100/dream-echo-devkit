import{a as y,c}from"./chunk-NB366X7J.mjs";function V(o,f){if(!o.initValues||typeof o.initValues!="object")throw new Error("");let s={baseId:f,formId:`${f}_form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};s.fieldsNames=Object.keys(o.initValues);for(let a of s.fieldsNames)s.fieldsNamesMap[a]=!0;for(let a in o.validationsSchema){if(s.validatedFieldsNames.push(a),s.validatedFieldsNamesMap[a]=!0,a in s.fieldsNamesMap){s.referencedValidatedFields.push(a),s.referencedValidatedFieldsMap[a]=!0;continue}s.manualValidatedFields.push(a),s.manualValidatedFieldsMap[a]=!0}return s}function p(o,f){let s={submit:!0},a=!1,d,m={};for(let t of f.validatedFieldsNames){let i=o.validationsSchema?.[t];if(m[t]={handler:i?y(i)?l=>i.parse(l):i:void 0,failedAttempts:0,passedAttempts:0,events:{change:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null},submit:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null}},isDirty:!1,metadata:{name:t}},o.validationEvents&&(a=!0,s={...s,...o.validationEvents}),a)for(d in s)m[t].events[d].isActive=!!typeof s[d]}return m}function S(o,f,s){let a={};for(let d of s.fieldsNames)a[d]={value:o.initValues[d],isUpdatingValueOnError:o.isUpdatingFieldsValueOnError,valueFromFieldToStore:o.valuesFromFieldsToStore?.[d]?o.valuesFromFieldsToStore[d]:void 0,valueFromStoreToField:o.valuesFromStoreToFields?.[d]?o.valuesFromStoreToFields[d]:void 0,errors:null,isDirty:!1,id:`${f}field-${String(d)}`,metadata:{name:d,initialValue:a[d].value}};return a}var E={fields:!0,validations:!0,submitCounter:!1};function h(o){let f=o.baseId?`${o.baseId}-`:"",s=V(o,f),a=S(o,f,s),d=p(o,s);return m=>({baseId:f,metadata:s,validations:d,fields:a,id:`${f}-form`,isDirty:!1,isSubmitting:!1,submitCounter:0,currentErrorsCounter:0,utils:{setIsSubmitting(t){m(function(i){return{...i,isSubmitting:typeof t=="function"?t(i.isSubmitting):t}})},resetFormStore:function(t=E){return m(function(i){let l=i.fields,e=i.validations,u=i.isDirty,r=i.submitCounter;if(t.fields)for(let n in l)l[n].value=l[n].metadata.initialValue;if(t.validations){for(let n in e){e[n].failedAttempts=0,e[n].passedAttempts=0,e[n].isDirty=!1;let F;for(F in e[n].events)e[n].events[F].failedAttempts=0,e[n].events[F].passedAttempts=0,e[n].events[F].isDirty=!1,e[n].events[F].message=null}u=!1}return t.submitCounter&&(r=0),{...i,fields:l,validations:e,isDirty:u,submitCounter:r}})},setFieldValue(t,i){return m(function(l){return{fields:{...l.fields,[t]:{...l.fields[t],value:typeof i=="function"?i(l.fields[t].value):i}}}})},setFieldErrors(t){m(function(i){if(!i.validations[t.name].events[t.validationEvent].isActive)return i;let l=i.currentErrorsCounter,e=i.validations[t.name],u=!!t.error;return u?(e.failedAttempts++,e.currentErrorsCounter++,l++,e.events[t.validationEvent].message=t.error,e.events[t.validationEvent].isDirty=u,e.events[t.validationEvent].failedAttempts++):(e.passedAttempts++,e.currentErrorsCounter--,l--,e.events[t.validationEvent].message=t.error,e.events[t.validationEvent].isDirty=u,e.events[t.validationEvent].passedAttempts++),e.isDirty=e.currentErrorsCounter===0,{...i,currentErrorsCounter:l,isDirty:l===0,validation:e}})},errorFormatter:o.errorFormatter??c,handleOnInputChange(t,i,l){m(function(e){let u=e.fields[t],r=l||(e.metadata.referencedValidatedFieldsMap[t]?t:void 0);if(r&&e.validations[r].events.change.isActive)try{e.utils.setFieldValue(t,e.validations[r].handler(typeof i=="function"?i(u.value):u.valueFromFieldToStore?u.valueFromFieldToStore(i):i,"change")),e.utils.setFieldErrors({name:r,error:null,validationEvent:"change"})}catch(n){e.utils.setFieldErrors({name:r,error:e.utils.errorFormatter(n,"change"),validationEvent:"change"})}else e.utils.setFieldValue(t,typeof i=="function"?i(u.value):u.valueFromFieldToStore?u.valueFromFieldToStore(i):i);return{...e,fields:{...e.fields,[t]:u}}})}}})}var g=function(o,f){return async function(s){s.preventDefault();let a=o();a.utils.setIsSubmitting(!0);let d=a.metadata,m=a.fields,t=a.validations,i={},l={},e={},u=!1,r;for(r in m){i[r]=m[r].value;try{let v=r in d.referencedValidatedFieldsMap&&t[r].handler;t[r].events.submit.isActive&&typeof v=="function"&&(l[r]=v(m[r].value,"submit")),e[r]={name:r,error:null,validationEvent:"submit"}}catch(v){e[r]={name:r,error:a.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}}let n;for(n of d.manualValidatedFields)try{let v=a.validations[n].handler;typeof v=="function"&&(l[n]=v(i,"submit")),e[n]={name:n,error:null,validationEvent:"submit"}}catch(v){e[n]={name:n,error:a.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}let F;for(F in e){let v=e[F];a.utils.setFieldErrors(e[F]),typeof v.error=="string"&&(u=!0)}a.utils.setIsSubmitting(!1),!u&&await f({event:s,values:i,validatedValues:l,hasError:u,errors:e})}};export{h as CreateFormStoreBuilder,g as handlePreSubmit};
//# sourceMappingURL=..mjs.map