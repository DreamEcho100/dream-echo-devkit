import{e as w}from"./chunk-YZBYERNR.mjs";var E=class{id;value;metadata;valueFromFieldToStore;valueFromStoreToField;constructor(a){this.id=a.id,this.value=a.value,this.metadata=a.metadata,this.valueFromFieldToStore=a.valueFromFieldToStore,this.valueFromStoreToField=a.valueFromStoreToField??(o=>o??"")}get storeToFieldValue(){return this.valueFromStoreToField(this.value)}};function N(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function x(e){return e instanceof Object&&"errors"in e}function T(e){return x(e)?e.errors.map(o=>o.message).join(`
`):e instanceof Error?e.message:"Something went wrong!"}function _(e,a){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let o={baseId:a,formId:`${a}-form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};o.fieldsNames=Object.keys(e.initialValues);for(let t of o.fieldsNames)o.fieldsNamesMap[t]=!0;if(e.validationSchema)for(let t in e.validationSchema){if(o.validatedFieldsNames.push(t),o.validatedFieldsNamesMap[t]=!0,t in o.fieldsNamesMap){o.referencedValidatedFields.push(t),o.referencedValidatedFieldsMap[t]=!0;continue}o.manualValidatedFields.push(t),o.manualValidatedFieldsMap[t]=!0}return o}function P(e,a){let o={submit:!0,blur:!0},t=!1,u,v={};if(!e.validationSchema)return v;for(let V of a.validatedFieldsNames){let h=e.validationSchema[V];if(v[V]={handler:h?N(h)?b=>h.parse(b.value):h:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.blur??!0},change:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.change??!1},submit:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.submit??!0}},currentEvent:null,isDirty:!1,metadata:{name:V}},e.validationEvents&&(t=!0,o={...o,...e.validationEvents}),t)for(u in o)v[V].events[u].isActive=!!typeof o[u]}return v}function I(e,a,o){let t={};for(let u of o.fieldsNames)t[u]=new E({value:e.initialValues[u],valueFromFieldToStore:e.valuesFromFieldsToStore?.[u]?e.valuesFromFieldsToStore[u]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[u]?e.valuesFromStoreToFields[u]:void 0,id:`${a}field-${String(u)}`,metadata:{name:u,initialValue:e.initialValues[u]}});return t}function g(e){return function(a){if(!a.validations[e.name].events[e.validationEvent].isActive)return a;let o=a.currentDirtyFieldsCounter,t={...a.validations[e.name]};return t.currentEvent=e.validationEvent,e.message?(t.failedAttempts++,t.events[e.validationEvent].failedAttempts++,t.isDirty||(t.currentDirtyEventsCounter++,t.currentDirtyEventsCounter>0&&o++),t.error={message:e.message},t.isDirty=!0):(t.passedAttempts++,t.events[e.validationEvent].passedAttempts++,t.isDirty&&(t.currentDirtyEventsCounter--,t.currentDirtyEventsCounter===0&&o--),t.error=null,t.isDirty=!1),a.currentDirtyFieldsCounter=o,a.isDirty=o>0,a.validations={...a.validations,[e.name]:t},a}}function C(e,a){return function(o){let t=o.fields[e];return t.value=typeof a=="function"?a(t.value):a,{...o,fields:{...o.fields,[e]:t}}}}var j={fields:!0,validations:!0,submit:!1,focus:!0};function G(e,a,o){let t=()=>{let i=a(),l={},n;for(n in i.fields)l[n]=i.fields[n].value;return l},u=i=>a().fields[i].value,v=i=>{e(function(l){return{submit:{...l.submit,...typeof i=="function"?i(l.submit):i}}})},V=(i,l,n)=>{e(function(s){let r=s;if(!n&&r.validations[l].events.blur.isActive){try{r.validations[l].handler({value:l&&i!==l?r.getValues():r.fields[i].value,name:i,get:a,validationEvent:"blur",...r._baseMethods}),r=g({name:l,message:null,validationEvent:"blur"})(r)}catch(S){let F=r.errorFormatter(S,"blur");r=g({name:l,message:F,validationEvent:"blur"})(r)}if(r.focus.isActive&&r.focus.field.name!==i)return r}return{...r,focus:n?{isActive:!0,field:{name:i,id:r.fields[i].id}}:{isActive:!1,field:null}}})},h=(i=j)=>e(function(l){let n=l.fields,s=l.validations,r=l.isDirty,S=l.submit,F=l.focus;if(i.fields){let d;for(d in n)n[d].value=n[d].metadata.initialValue}if(i.validations){for(let d in s){s[d].failedAttempts=0,s[d].passedAttempts=0,s[d].currentEvent=null,s[d].isDirty=!1,s[d].error=null;let c;for(c in s[d].events)s[d].events[c].isActive=!1,s[d].events[c].failedAttempts=0,s[d].events[c].passedAttempts=0}r=!1}return i.submit&&(S={counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1}),i.focus&&(F={isActive:!1,field:null}),{fields:n,validations:s,isDirty:r,submit:S,focus:F}}),b=(i,l)=>e(C(i,l)),B=i=>{e(g(i))},D=o.errorFormatter??T;return{getValues:t,errorFormatter:D,getValue:u,setSubmitState:v,setFocusState:V,resetFormStore:h,setFieldValue:b,setFieldError:B,handleInputChange:(i,l,n)=>{let s=a(),r=s.fields[i],S=typeof l=="function"?l(r.value):l,F=r.valueFromFieldToStore?r.valueFromFieldToStore(S):S,d=n||(s.metadata.referencedValidatedFieldsMap[i]?i:void 0),c=C,y=g;if(d&&s.validations[d].events.change.isActive)try{s=c(i,s.validations[d].handler({value:n&&n!==i?s.getValues():F,name:i,get:a,validationEvent:"change",...s._baseMethods}))(s),s=y({name:d,message:null,validationEvent:"change"})(s)}catch(f){s=y({name:d,message:s.errorFormatter(f,"change"),validationEvent:"change"})(s),s=c(i,F)(s)}else s=c(i,F)(s);e(s)},getFieldEventsListeners:(i,l)=>{let n=a(),s=l??i;return{onChange:r=>{n.handleInputChange(i,r.target.value)},onFocus:()=>{n.setFocusState(i,s,!0)},onBlur:()=>{n.setFocusState(i,s,!1)}}},handleSubmit:i=>async function(l){l.preventDefault();let n=a();n.setSubmitState({isActive:!0});let s=n.metadata,r=n.fields,S=n.validations,F={},d={},c={},y=!1,f;for(f in r){F[f]=r[f].value;try{let m=f in s.referencedValidatedFieldsMap&&S[f].handler;if(typeof m!="function"||!S[f].events.submit.isActive)continue;d[f]=m({value:r[f].value,name:f,get:a,validationEvent:"submit",...n._baseMethods}),c[f]={name:f,message:null,validationEvent:"submit"}}catch(m){c[f]={name:f,message:n.errorFormatter(m,"submit"),validationEvent:"submit"}}}let p;for(p of s.manualValidatedFields)try{let m=n.validations[p].handler;if(typeof m!="function")continue;d[p]=m({value:void 0,name:void 0,get:a,validationEvent:"submit",...n._baseMethods}),c[p]={name:p,message:null,validationEvent:"submit"}}catch(m){c[p]={name:p,message:n.errorFormatter(m,"submit"),validationEvent:"submit"}}let A=a(),M;for(M in c){let m=c[M];A=g(c[M])(A),typeof m.message=="string"&&(y=!0)}if(y)e(A),n.setSubmitState(m=>({isActive:!1,counter:m.counter+1,failedAttempts:m.counter+1,errorMessage:null}));else try{await i({event:l,values:F,validatedValues:d,hasError:y,errors:c}),n.setSubmitState(m=>({isActive:!1,counter:m.counter+1,passedAttempts:m.counter+1,errorMessage:null}))}catch(m){n.setSubmitState(k=>({isActive:!1,counter:k.counter+1,failedAttempts:k.counter+1,errorMessage:n.errorFormatter(m,"submit")}))}}}}function z(e){return(a,o)=>{let t=G(a,o,e),u=e.baseId?`${e.baseId}-`:"",v=_(e,u),V=I(e,u,v),h=P(e,v);return{baseId:u,metadata:v,validations:h,fields:V,id:`${u}form`,isDirty:!1,submit:{counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1},focus:{isActive:!1,field:null},currentDirtyFieldsCounter:0,_baseMethods:t,...t}}}export{z as createFormStoreBuilder,T as errorFormatter,w as fvh,x as isZodError,N as isZodValidator};
//# sourceMappingURL=index.mjs.map