export { e as fvh } from './chunk-DFB4Y4S4.mjs';

function N(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function _(e){return e instanceof Object&&"errors"in e}function C(e){return _(e)?e.formErrors.formErrors.length>0?{message:e.formErrors.formErrors[0]}:e.errors:e instanceof Error?e:{message:"Something went wrong!"}}var E=class{id;value;metadata;valueFromFieldToStore;valueFromStoreToField;constructor(i){this.id=i.id,this.value=i.value,this.metadata=i.metadata,this.valueFromFieldToStore=i.valueFromFieldToStore,this.valueFromStoreToField=i.valueFromStoreToField??(s=>s??"");}get storeToFieldValue(){return this.valueFromStoreToField(this.value)}};function T(e,i){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let s={baseId:i,formId:`${i}-form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};s.fieldsNames=Object.keys(e.initialValues);for(let t of s.fieldsNames)s.fieldsNamesMap[t]=!0;if(e.validationSchema)for(let t in e.validationSchema){if(s.validatedFieldsNames.push(t),s.validatedFieldsNamesMap[t]=!0,t in s.fieldsNamesMap){s.referencedValidatedFields.push(t),s.referencedValidatedFieldsMap[t]=!0;continue}s.manualValidatedFields.push(t),s.manualValidatedFieldsMap[t]=!0;}return s}function I(e,i){let s={submit:!0,focus:!0},t=!1,u,v={};if(!e.validationSchema)return v;for(let V of i.validatedFieldsNames){let h=e.validationSchema[V];if(v[V]={handler:h?N(h)?A=>h.parse(A.value):h:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{change:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.change??!1},focus:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.focus??!0},submit:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.submit??!0}},currentEvent:null,isDirty:!1,metadata:{name:V}},e.validationEvents&&(t=!0,s={...s,...e.validationEvents}),t)for(u in s)v[V].events[u].isActive=!!typeof s[u];}return v}function P(e,i,s){let t={};for(let u of s.fieldsNames)t[u]=new E({value:e.initialValues[u],valueFromFieldToStore:e.valuesFromFieldsToStore?.[u]?e.valuesFromFieldsToStore[u]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[u]?e.valuesFromStoreToFields[u]:void 0,id:`${i}field-${String(u)}`,metadata:{name:u,initialValue:e.initialValues[u]}});return t}function b(e){return function(i){if(!i.validations[e.name].events[e.validationEvent].isActive)return i;let s=i.currentDirtyFieldsCounter,t={...i.validations[e.name]};return t.currentEvent=e.validationEvent,e.error?(t.failedAttempts++,t.events[e.validationEvent].failedAttempts++,t.isDirty||(t.currentDirtyEventsCounter++,t.currentDirtyEventsCounter>0&&s++),t.isDirty=!0,t.error=e.error):(t.passedAttempts++,t.events[e.validationEvent].passedAttempts++,t.isDirty&&(t.currentDirtyEventsCounter--,t.currentDirtyEventsCounter===0&&s--),t.isDirty=!1,t.error=null),i.currentDirtyFieldsCounter=s,i.isDirty=s>0,i.validations={...i.validations,[e.name]:t},i}}function D(e,i){return function(s){let t=s.fields[e];return t.value=typeof i=="function"?i(t.value):i,{...s,fields:{...s.fields,[e]:t}}}}var K={fields:!0,validations:!0,submit:!1,focus:!0};function j(e,i,s){let t=()=>{let a=i(),n={},r;for(r in a.fields)n[r]=a.fields[r].value;return n},u=a=>i().fields[a].value,v=a=>{e(function(n){return {submit:{...n.submit,...typeof a=="function"?a(n.submit):a}}});},V=(a,n,r)=>{e(function(o){let l=o;if(l.validations[n].events.focus.isActive){try{l.validations[n].handler({value:!n||a===n?l.fields[a].value:void 0,name:a,validationEvent:"focus",get:i,getValue:l._baseMethods.getValue,getValues:l._baseMethods.getValues}),l=b({name:n,error:null,validationEvent:"focus"})(l);}catch(S){let F=l.errorFormatter(S,"focus");l=b({name:n,error:F,validationEvent:"focus"})(l);}if(l.focus.isActive&&l.focus.field.name===a)return l}return {focus:r==="in"?{isActive:!0,field:{name:a,id:l.fields[a].id}}:{isActive:!1,field:null}}});},h=(a=K)=>e(function(n){let r=n.fields,o=n.validations,l=n.isDirty,S=n.submit,F=n.focus;if(a.fields){let d;for(d in r)r[d].value=r[d].metadata.initialValue;}if(a.validations){for(let d in o){o[d].failedAttempts=0,o[d].passedAttempts=0,o[d].currentEvent=null,o[d].isDirty=!1,o[d].error=null;let c;for(c in o[d].events)o[d].events[c].isActive=!1,o[d].events[c].failedAttempts=0,o[d].events[c].passedAttempts=0;}l=!1;}return a.submit&&(S={counter:0,passedAttempts:0,failedAttempts:0,error:null,isActive:!1}),a.focus&&(F={isActive:!1,field:null}),{fields:r,validations:o,isDirty:l,submit:S,focus:F}}),A=(a,n)=>e(D(a,n)),B=a=>{e(b(a));},w=s.errorFormatter??C;return {getValues:t,errorFormatter:w,getValue:u,setSubmitState:v,setFocusState:V,resetFormStore:h,setFieldValue:A,setFieldError:B,handleInputChange:(a,n,r)=>{let o=i(),l=o.fields[a],S=typeof n=="function"?n(l.value):n,F=l.valueFromFieldToStore?l.valueFromFieldToStore(S):S,d=r||(o.metadata.referencedValidatedFieldsMap[a]?a:void 0),c=D,y=b;if(d&&o.validations[d].events.change.isActive)try{o=c(a,o.validations[d].handler({value:r&&r!==a?o.getValues():F,name:a,get:i,validationEvent:"change",getValue:o._baseMethods.getValue,getValues:o._baseMethods.getValues}))(o),o=y({name:d,error:null,validationEvent:"change"})(o);}catch(f){o=y({name:d,error:o.errorFormatter(f,"change"),validationEvent:"change"})(o),o=c(a,F)(o);}else o=c(a,F)(o);e(o);},getFieldEventsListeners:(a,n)=>{let r=i(),o=n??a;return {onChange:l=>{r.handleInputChange(a,l.target.value);},onFocus:()=>{r.setFocusState(a,o,"in");},onBlur:()=>{r.setFocusState(a,o,"out");}}},handleSubmit:a=>async function(n){n.preventDefault();let r=i();r.setSubmitState({isActive:!0});let o=r.metadata,l=r.fields,S=r.validations,F={},d={},c={},y=!1,f;for(f in l){F[f]=l[f].value;try{let m=f in o.referencedValidatedFieldsMap&&S[f].handler;if(typeof m!="function"||!S[f].events.submit.isActive)continue;d[f]=m({value:l[f].value,name:f,get:i,validationEvent:"submit",...r._baseMethods}),c[f]={name:f,error:null,validationEvent:"submit"};}catch(m){c[f]={name:f,error:r.errorFormatter(m,"submit"),validationEvent:"submit"};}}let p;for(p of o.manualValidatedFields)try{let m=r.validations[p].handler;if(typeof m!="function")continue;d[p]=m({value:void 0,name:void 0,get:i,validationEvent:"submit",...r._baseMethods}),c[p]={name:p,error:null,validationEvent:"submit"};}catch(m){c[p]={name:p,error:r.errorFormatter(m,"submit"),validationEvent:"submit"};}let g=i(),M;for(M in c){let m=c[M];g=b(c[M])(g),m.error&&(y=!0);}if(y)e(g),r.setSubmitState(m=>({isActive:!1,counter:m.counter+1,failedAttempts:m.counter+1,error:null}));else try{await a({event:n,values:F,validatedValues:d,hasError:y,errors:c}),r.setSubmitState(m=>({isActive:!1,counter:m.counter+1,passedAttempts:m.counter+1,error:null}));}catch(m){r.setSubmitState(k=>({isActive:!1,counter:k.counter+1,failedAttempts:k.counter+1,error:r.errorFormatter(m,"submit")}));}}}}function z(e){return (i,s)=>{let t=j(i,s,e),u=e.baseId?`${e.baseId}-`:"",v=T(e,u),V=P(e,u,v),h=I(e,v);return {baseId:u,metadata:v,validations:h,fields:V,id:`${u}form`,isDirty:!1,submit:{counter:0,passedAttempts:0,failedAttempts:0,error:null,isActive:!1},focus:{isActive:!1,field:null},currentDirtyFieldsCounter:0,_baseMethods:t,...t}}}

export { z as createFormStoreBuilder, C as errorFormatter, _ as isZodError, N as isZodValidator };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.mjs.map