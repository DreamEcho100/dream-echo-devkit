function I(s,l){let i="";switch(l){case"date":i=s.toISOString().slice(0,10);break;case"time":i=s.toTimeString().slice(0,8);break;case"datetime-local":i=s.toISOString().slice(0,16),i=i.replace("T"," ");break;case"week":let p=s.getFullYear(),c=w(s);i=`${p}-W${c.toString().length<2?"0"+c.toString():c.toString()}`;break;case"month":i=s.toISOString().slice(0,7);break;default:break}return i}function O(s,l){let i;switch(l){case"date":i=new Date(s);break;case"time":let[p,c,f]=s.toString().split(":");i=new Date,i.setHours(Number(p)),i.setMinutes(Number(c)),i.setSeconds(Number(f));break;case"datetime-local":i=new Date(s.toString().replace(" ","T"));break;case"week":let[y,S]=s.toString().split("-W"),k=Number(y),F=Number(S);i=N(k,F);break;case"month":i=new Date(`${s}-01`);break;default:i=new Date;break}return i}function w(s){let l=new Date(s.getFullYear(),0,1),i=(s.valueOf()-l.valueOf())/(1e3*60*60*24);return Math.floor(i/7)+1}function N(s,l){let i=new Date(s,0,1),p=(8-i.getDay())%7,c=new Date(i);c.setDate(i.getDate()+p);let f=(l-1)*7,y=new Date(c);return y.setDate(c.getDate()+f),y}var T={formatDate:I,parseDate:O,getWeekNumber:w,getFirstDateOfWeek:N},C=T;import{createStore as $}from"zustand";import{useRef as P,useId as H}from"react";var j=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let l=Math.random()*16|0;return(s==="x"?l:l&3|8).toString(16)}),M=s=>s instanceof Object&&"parseAsync"in s&&typeof s.parseAsync=="function",R=s=>s instanceof Object&&"errors"in s,Z=({isUpdatingFieldsValueOnError:s=!0,trackValidationHistory:l=!1,valuesFromFieldsToStore:i,valuesFromStoreToFields:p,validationSchema:c,...f})=>{if(!f.initValues||typeof f.initValues!="object")throw new Error("");let y=typeof f.baseId=="boolean"?j():f.baseId?`${f.baseId}-`:"",S={fieldsNames:Object.keys(f.initValues),formId:`${y}form`},k=0,F={},D,x,h={submit:!0},E=!1,g;for(let o of S.fieldsNames){let v=c?.[o];if(x={handler:v?M(v)?e=>v.parse(e):v:void 0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:!1},change:{failedAttempts:0,passedAttempts:0,isActive:!1},mount:{failedAttempts:0,passedAttempts:0,isActive:!1},submit:{failedAttempts:0,passedAttempts:0,isActive:!1}}},D=f.initValues[o],f.validationEvents&&(E=!0,h={...h,...f.validationEvents}),F[o]={value:D,isUpdatingValueOnError:s,valueFromFieldToStore:i?.[o]?i[o]:void 0,valueFromStoreToField:p?.[o]?p[o]:void 0},E)for(g in h)x.events[g].isActive=!!typeof h[g];F[o]={...F[o],errors:null,isDirty:!1,metadata:{id:`${y}field-${String(o)}`,name:o,initialValue:F[o].value},validation:x}}return $((o,v)=>({fields:F,metadata:S,submitCounter:k,isTrackingValidationHistory:l,validations:{history:[]},errors:{},utils:{resetFieldsErrors:()=>o(e=>({fields:Object.fromEntries(e.metadata.fieldsNames.map(r=>[r,{...e.fields[r],errors:null,isDirty:!1}])),errors:{}})),handleOnInputChange:(e,a)=>{let r=v(),t=r.utils.handleFieldValidation({name:e,value:a,validationEvent:"change"});r.utils.setFieldValue(e,t)},errorFormatter:e=>R(e)?e.format()._errors:e instanceof Error?[e.message]:["Something went wrong!"],reInitFieldsValues:()=>o(e=>{let a=e.metadata.fieldsNames,r=e.fields,t;for(t of a)r[t]={...r[t],value:r[t].metadata.initialValue};return{fields:r}}),setFieldValue:(e,a)=>o(r=>({fields:{...r.fields,[e]:{...r.fields[e],value:typeof a=="function"?a(r.fields[e].value):a}}})),setFieldErrors:e=>o(a=>{let r=!!e.errors,t=a.fields[e.name];return t={...t,isDirty:r,errors:e.errors,validation:{...t.validation,events:{...t.validation.events,[e.validationEvent]:{...t.validation.events[e.validationEvent],failedAttempts:r?t.validation.events[e.validationEvent].failedAttempts:t.validation.events[e.validationEvent].failedAttempts+1,passedAttempts:r?t.validation.events[e.validationEvent].passedAttempts:t.validation.events[e.validationEvent].passedAttempts+1}}}},{fields:{...a.fields,[e.name]:t},errors:{...a.errors,[e.name]:e.errors}}}),createValidationHistoryRecord:({fields:e,validationEvent:a,validationEventPhase:r,validationEventState:t})=>{let u=[];r==="start"&&u.push(`Starting the validation for fields: [${Object.keys(e).join(", ")}]`),r==="end"&&u.push(`Ending the validation for fields: [${Object.keys(e).join(", ")}]`),u.push(`Validation ${t[0].toUpperCase()+t.slice(1)}!`),e.forEach(m=>{u.push(`Field: ${String(m.metadata.name)}, Failed Attempts: ${m.validation.events[a].failedAttempts}, Passed Attempt: ${m.validation.events[a].passedAttempts}`)})},handleFieldValidation:({name:e,validationEvent:a,value:r})=>{let t=v(),u=typeof r=="function"?r(t.fields[e].value):r;if(!t.fields[e].validation.events[a].isActive)return u;let m=t.fields[e].validation.handler;if(!m)return u;t.fields[e].valueFromFieldToStore;let d=t.fields[e].valueFromFieldToStore?t.fields[e].valueFromFieldToStore(u):u,b=n=>(t.utils.setFieldErrors({name:e,errors:t.utils.errorFormatter(n,a),validationEvent:a}),t.fields[e].isUpdatingValueOnError?d:t.fields[e].value);if(t.isTrackingValidationHistory)try{t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:a,validationEventPhase:"start",validationEventState:"processing"}),d=m(d,a),t.fields[e].isDirty&&t.utils.setFieldErrors({name:e,errors:null,validationEvent:a}),t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:a,validationEventPhase:"end",validationEventState:"passed"})}catch(n){d=b(n),t.utils.createValidationHistoryRecord({fields:[t.fields[e]],validationEvent:a,validationEventPhase:"end",validationEventState:"failed"})}else try{d=m(d,a),t.fields[e].isDirty&&t.utils.setFieldErrors({name:e,errors:null,validationEvent:a})}catch(n){d=b(n)}return d},handlePreSubmit:e=>a=>{if(a.preventDefault(),!e)return;let r=v(),t=r.fields,u={},m={},d={},b=!1,n;for(n in t)try{let V=t[n].validation.handler;t[n].validation.events.submit.isActive&&typeof V=="function"&&(m[n]=V(t[n].value,"submit")),u[n]=t[n].value,d[n]={name:n,errors:null,validationEvent:"submit"}}catch(V){d[n]={name:n,errors:r.utils.errorFormatter(V,"submit"),validationEvent:"submit"},b=!0}let A;for(A in d)r.utils.setFieldErrors(d[A]);b||e(a,{values:u,validatedValues:m,hasError:b,errors:d})}}}))},Y=s=>{let l=H();return P(Z({...s,baseId:s.baseId||l})).current};export{Z as handleCreateFormStore,C as inputDateHelpers,Y as useCreateFormStore};
//# sourceMappingURL=index.mjs.map