export { e as fvh } from './chunk-DFB4Y4S4.mjs';

function N(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function x(e){return e instanceof Object&&"errors"in e}function C(e){return x(e)?e.formErrors.formErrors.length>0?{message:e.formErrors.formErrors[0]}:e.errors:e instanceof Error?e:{message:"Something went wrong!"}}var E=class{id;value;metadata;valueFromFieldToStore;valueFromStoreToField;constructor(i){this.id=i.id,this.value=i.value,this.metadata=i.metadata,this.valueFromFieldToStore=i.valueFromFieldToStore,this.valueFromStoreToField=i.valueFromStoreToField??(r=>r??"");}get storeToFieldValue(){return this.valueFromStoreToField(this.value)}};function T(e,i){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let r={baseId:i,formId:`${i}-form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};r.fieldsNames=Object.keys(e.initialValues);for(let t of r.fieldsNames)r.fieldsNamesMap[t]=!0;if(e.validationSchema)for(let t in e.validationSchema){if(r.validatedFieldsNames.push(t),r.validatedFieldsNamesMap[t]=!0,t in r.fieldsNamesMap){r.referencedValidatedFields.push(t),r.referencedValidatedFieldsMap[t]=!0;continue}r.manualValidatedFields.push(t),r.manualValidatedFieldsMap[t]=!0;}return r}function I(e,i){let r={submit:!0,blur:!0},t=!1,u,v={};if(!e.validationSchema)return v;for(let V of i.validatedFieldsNames){let h=e.validationSchema[V];if(v[V]={handler:h?N(h)?g=>h.parse(g.value):h:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.blur??!0},change:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.change??!1},submit:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.submit??!0}},currentEvent:null,isDirty:!1,metadata:{name:V}},e.validationEvents&&(t=!0,r={...r,...e.validationEvents}),t)for(u in r)v[V].events[u].isActive=!!typeof r[u];}return v}function P(e,i,r){let t={};for(let u of r.fieldsNames)t[u]=new E({value:e.initialValues[u],valueFromFieldToStore:e.valuesFromFieldsToStore?.[u]?e.valuesFromFieldsToStore[u]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[u]?e.valuesFromStoreToFields[u]:void 0,id:`${i}field-${String(u)}`,metadata:{name:u,initialValue:e.initialValues[u]}});return t}function b(e){return function(i){if(!i.validations[e.name].events[e.validationEvent].isActive)return i;let r=i.currentDirtyFieldsCounter,t={...i.validations[e.name]};return t.currentEvent=e.validationEvent,e.error?(t.failedAttempts++,t.events[e.validationEvent].failedAttempts++,t.isDirty||(t.currentDirtyEventsCounter++,t.currentDirtyEventsCounter>0&&r++),t.isDirty=!0,t.error=e.error):(t.passedAttempts++,t.events[e.validationEvent].passedAttempts++,t.isDirty&&(t.currentDirtyEventsCounter--,t.currentDirtyEventsCounter===0&&r--),t.isDirty=!1,t.error=null),i.currentDirtyFieldsCounter=r,i.isDirty=r>0,i.validations={...i.validations,[e.name]:t},i}}function D(e,i){return function(r){let t=r.fields[e];return t.value=typeof i=="function"?i(t.value):i,{...r,fields:{...r.fields,[e]:t}}}}var K={fields:!0,validations:!0,submit:!1,focus:!0};function j(e,i,r){let t=()=>{let a=i(),l={},s;for(s in a.fields)l[s]=a.fields[s].value;return l},u=a=>i().fields[a].value,v=a=>{e(function(l){return {submit:{...l.submit,...typeof a=="function"?a(l.submit):a}}});},V=(a,l,s)=>{e(function(o){let n=o;if(!s&&n.validations[l].events.blur.isActive){try{n.validations[l].handler({value:l&&a!==l?n.getValues():n.fields[a].value,name:a,validationEvent:"blur",get:i,getValue:n._baseMethods.getValue,getValues:n._baseMethods.getValues}),n=b({name:l,error:null,validationEvent:"blur"})(n);}catch(S){let F=n.errorFormatter(S,"blur");n=b({name:l,error:F,validationEvent:"blur"})(n);}if(n.focus.isActive&&n.focus.field.name!==a)return n}return {getValue:n._baseMethods.getValue,getValues:n._baseMethods.getValues,focus:s?{isActive:!0,field:{name:a,id:n.fields[a].id}}:{isActive:!1,field:null}}});},h=(a=K)=>e(function(l){let s=l.fields,o=l.validations,n=l.isDirty,S=l.submit,F=l.focus;if(a.fields){let d;for(d in s)s[d].value=s[d].metadata.initialValue;}if(a.validations){for(let d in o){o[d].failedAttempts=0,o[d].passedAttempts=0,o[d].currentEvent=null,o[d].isDirty=!1,o[d].error=null;let c;for(c in o[d].events)o[d].events[c].isActive=!1,o[d].events[c].failedAttempts=0,o[d].events[c].passedAttempts=0;}n=!1;}return a.submit&&(S={counter:0,passedAttempts:0,failedAttempts:0,error:null,isActive:!1}),a.focus&&(F={isActive:!1,field:null}),{fields:s,validations:o,isDirty:n,submit:S,focus:F}}),g=(a,l)=>e(D(a,l)),B=a=>{e(b(a));},w=r.errorFormatter??C;return {getValues:t,errorFormatter:w,getValue:u,setSubmitState:v,setFocusState:V,resetFormStore:h,setFieldValue:g,setFieldError:B,handleInputChange:(a,l,s)=>{let o=i(),n=o.fields[a],S=typeof l=="function"?l(n.value):l,F=n.valueFromFieldToStore?n.valueFromFieldToStore(S):S,d=s||(o.metadata.referencedValidatedFieldsMap[a]?a:void 0),c=D,y=b;if(d&&o.validations[d].events.change.isActive)try{o=c(a,o.validations[d].handler({value:s&&s!==a?o.getValues():F,name:a,get:i,validationEvent:"change",getValue:o._baseMethods.getValue,getValues:o._baseMethods.getValues}))(o),o=y({name:d,error:null,validationEvent:"change"})(o);}catch(f){o=y({name:d,error:o.errorFormatter(f,"change"),validationEvent:"change"})(o),o=c(a,F)(o);}else o=c(a,F)(o);e(o);},getFieldEventsListeners:(a,l)=>{let s=i(),o=l??a;return {onChange:n=>{s.handleInputChange(a,n.target.value);},onFocus:()=>{s.setFocusState(a,o,!0);},onBlur:()=>{s.setFocusState(a,o,!1);}}},handleSubmit:a=>async function(l){l.preventDefault();let s=i();s.setSubmitState({isActive:!0});let o=s.metadata,n=s.fields,S=s.validations,F={},d={},c={},y=!1,f;for(f in n){F[f]=n[f].value;try{let m=f in o.referencedValidatedFieldsMap&&S[f].handler;if(typeof m!="function"||!S[f].events.submit.isActive)continue;d[f]=m({value:n[f].value,name:f,get:i,validationEvent:"submit",...s._baseMethods}),c[f]={name:f,error:null,validationEvent:"submit"};}catch(m){c[f]={name:f,error:s.errorFormatter(m,"submit"),validationEvent:"submit"};}}let p;for(p of o.manualValidatedFields)try{let m=s.validations[p].handler;if(typeof m!="function")continue;d[p]=m({value:void 0,name:void 0,get:i,validationEvent:"submit",...s._baseMethods}),c[p]={name:p,error:null,validationEvent:"submit"};}catch(m){c[p]={name:p,error:s.errorFormatter(m,"submit"),validationEvent:"submit"};}let A=i(),M;for(M in c){let m=c[M];A=b(c[M])(A),m.error&&(y=!0);}if(y)e(A),s.setSubmitState(m=>({isActive:!1,counter:m.counter+1,failedAttempts:m.counter+1,error:null}));else try{await a({event:l,values:F,validatedValues:d,hasError:y,errors:c}),s.setSubmitState(m=>({isActive:!1,counter:m.counter+1,passedAttempts:m.counter+1,error:null}));}catch(m){s.setSubmitState(k=>({isActive:!1,counter:k.counter+1,failedAttempts:k.counter+1,error:s.errorFormatter(m,"submit")}));}}}}function z(e){return (i,r)=>{let t=j(i,r,e),u=e.baseId?`${e.baseId}-`:"",v=T(e,u),V=P(e,u,v),h=I(e,v);return {baseId:u,metadata:v,validations:h,fields:V,id:`${u}form`,isDirty:!1,submit:{counter:0,passedAttempts:0,failedAttempts:0,error:null,isActive:!1},focus:{isActive:!1,field:null},currentDirtyFieldsCounter:0,_baseMethods:t,...t}}}

export { z as createFormStoreBuilder, C as errorFormatter, x as isZodError, N as isZodValidator };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.mjs.map