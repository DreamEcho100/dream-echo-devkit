var b=class{id;value;metadata;valueFromFieldToStore;valueFromStoreToField;constructor(s){this.id=s.id,this.value=s.value,this.metadata=s.metadata,this.valueFromFieldToStore=s.valueFromFieldToStore,this.valueFromStoreToField=s.valueFromStoreToField??(()=>this.value)}get storeToFieldValue(){return this.valueFromStoreToField(this.value)}};function D(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function M(e){return e instanceof Object&&"errors"in e}function H(e){return M(e)?e.format()._errors.join(", "):e instanceof Error?e.message:"Something went wrong!"}function C(e,s){let t="";switch(s){case"date":t=e.toISOString().slice(0,10);break;case"time":t=e.toTimeString().slice(0,8);break;case"datetime-local":t=`${e.getFullYear()}-${`${e.getMonth()+1}`.padStart(2,"0")}-${`${e.getDate()}`.padStart(2,"0")}T${`${e.getHours()}`.padStart(2,"0")}:${`${e.getMinutes()}`.padStart(2,"0")}`;break;case"week":let a=e.getFullYear(),d=A(e);t=`${a}-W${d.toString().length<2?"0"+d.toString():d.toString()}`;break;case"month":t=e.toISOString().slice(0,7);break;default:break}return t}function x(e,s){let t;switch(s){case"date":t=new Date(e);break;case"time":let[a,d,c]=e.toString().split(":");t=new Date,t.setHours(Number(a||0)),t.setMinutes(Number(d||0)),t.setSeconds(Number(c||0));break;case"datetime-local":t=new Date(e.toString().replace(" ","T"));break;case"week":let[F,i]=e.toString().split("-W"),n=Number(F),o=Number(i);t=w(n,o);break;case"month":t=new Date(`${e}-01`);break;default:t=new Date;break}return t}function A(e){let s=new Date(e.getFullYear(),0,1),t=(e.valueOf()-s.valueOf())/(1e3*60*60*24);return Math.floor(t/7)+1}function w(e,s){let t=new Date(e,0,1),a=(8-t.getDay())%7,d=new Date(t);d.setDate(t.getDate()+a);let c=(s-1)*7,F=new Date(d);return F.setDate(d.getDate()+c),F}var W={formatDate:C,parseDate:x,getWeekNumber:A,getFirstDateOfWeek:w};import{createStore as I}from"zustand";import{useId as $,useState as P}from"react";var _=e=>I(N(e)),z=e=>{let s=$();return P(_({...e,baseId:e.baseId||s}))[0]};function j(e,s){if(!e.initialValues||typeof e.initialValues!="object")throw new Error("");let t={baseId:s,formId:`${s}-form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};t.fieldsNames=Object.keys(e.initialValues);for(let a of t.fieldsNames)t.fieldsNamesMap[a]=!0;for(let a in e.validationsHandlers){if(t.validatedFieldsNames.push(a),t.validatedFieldsNamesMap[a]=!0,a in t.fieldsNamesMap){t.referencedValidatedFields.push(a),t.referencedValidatedFieldsMap[a]=!0;continue}t.manualValidatedFields.push(a),t.manualValidatedFieldsMap[a]=!0}return t}function Z(e,s){let t={submit:!0,blur:!0},a=!1,d,c={};for(let F of s.validatedFieldsNames){let i=e.validationsHandlers?.[F];if(c[F]={handler:i?D(i)?n=>i.parse(n):i:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{blur:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.blur??!0,isDirty:!1,error:null},change:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.change??!1,isDirty:!1,error:null},submit:{failedAttempts:0,passedAttempts:0,isActive:e.validationEvents?.submit??!1,isDirty:!1,error:null}},isDirty:!1,metadata:{name:F}},e.validationEvents&&(a=!0,t={...t,...e.validationEvents}),a)for(d in t)c[F].events[d].isActive=!!typeof t[d]}return c}function O(e,s,t){let a={};for(let d of t.fieldsNames)a[d]=new b({value:e.initialValues[d],valueFromFieldToStore:e.valuesFromFieldsToStore?.[d]?e.valuesFromFieldsToStore[d]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[d]?e.valuesFromStoreToFields[d]:void 0,id:`${s}field-${String(d)}`,metadata:{name:d,initialValue:e.initialValues[d]}});return a}function g(e){return function(s){if(!s.validations[e.name].events[e.validationEvent].isActive)return s;let t=s.currentDirtyFieldsCounter,a={...s.validations[e.name]};return e.message?(a.failedAttempts++,a.events[e.validationEvent].failedAttempts++,a.isDirty||(a.currentDirtyEventsCounter++,a.currentDirtyEventsCounter>0&&t++),a.events[e.validationEvent].error={message:e.message},a.error={message:e.message},a.events[e.validationEvent].isDirty=!0,a.isDirty=!0):(a.passedAttempts++,a.events[e.validationEvent].passedAttempts++,a.isDirty&&(a.currentDirtyEventsCounter--,a.currentDirtyEventsCounter===0&&t--),a.events[e.validationEvent].error=null,a.error=null,a.events[e.validationEvent].isDirty=!1,a.isDirty=!1),s.currentDirtyFieldsCounter=t,s.isDirty=t>0,s.validations={...s.validations,[e.name]:a},s}}function T(e,s){return function(t){let a=t.fields[e];return a.value=typeof s=="function"?s(a.value):s,{...t,fields:{...t.fields,[e]:a}}}}var B={fields:!0,validations:!0,submit:!1,focus:!0};function N(e){let s=e.baseId?`${e.baseId}-`:"",t=j(e,s),a=O(e,s,t),d=Z(e,t);return(c,F)=>({baseId:s,metadata:t,validations:d,fields:a,id:`${s}form`,isDirty:!1,submit:{counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1},focus:{isActive:!1,field:null},currentDirtyFieldsCounter:0,utils:{setSubmitState(i){c(function(n){return{submit:{...n.submit,...typeof i=="function"?i(n.submit):i}}})},setFocusState(i,n,o){c(function(r){let l=r;if(!o&&l.validations[n].events.blur.isActive){try{l.validations[n].handler(l.fields[i].value,"blur"),l=g({name:n,message:null,validationEvent:"blur"})(l)}catch(p){let y=l.utils.errorFormatter(p,"blur");l=g({name:n,message:y,validationEvent:"blur"})(l)}if(l.focus.isActive&&l.focus.field.name!==i)return l}return{...l,focus:o?{isActive:!0,field:{name:i,id:l.fields[i].id}}:{isActive:!1,field:null}}})},resetFormStore:function(i=B){return c(function(n){let o=n.fields,r=n.validations,l=n.isDirty,p=n.submit,y=n.focus;if(i.fields){let u;for(u in o)o[u].value=o[u].metadata.initialValue}if(i.validations){for(let u in r){r[u].failedAttempts=0,r[u].passedAttempts=0,r[u].isDirty=!1,r[u].error=null;let f;for(f in r[u].events)r[u].events[f].failedAttempts=0,r[u].events[f].passedAttempts=0,r[u].events[f].isDirty=!1,r[u].events[f].error=null}l=!1}return i.submit&&(p={counter:0,passedAttempts:0,failedAttempts:0,errorMessage:null,isActive:!1}),i.focus&&(y={isActive:!1,field:null}),{fields:o,validations:r,isDirty:l,submit:p,focus:y}})},setFieldValue(i,n){return c(T(i,n))},setFieldError(i){c(g(i))},errorFormatter:e.errorFormatter??H,handleOnInputChange(i,n,o){let r=F(),l=r.fields[i],p=typeof n=="function"?n(l.value):n,y=l.valueFromFieldToStore?l.valueFromFieldToStore(p):p,u=o||(r.metadata.referencedValidatedFieldsMap[i]?i:void 0),f=T,S=g;if(u&&r.validations[u].events.change.isActive)try{r=f(i,r.validations[u].handler(y,"change"))(r),r=S({name:u,message:null,validationEvent:"change"})(r)}catch(v){r=S({name:u,message:r.utils.errorFormatter(v,"change"),validationEvent:"change"})(r),r=f(i,y)(r)}else r=f(i,y)(r);c(r)},getFieldEventsListeners(i,n){let o=F(),r=n??i;return{onChange:l=>{o.utils.handleOnInputChange(i,l.target.value)},onFocus:()=>{o.utils.setFocusState(i,r,!0)},onBlur:()=>{o.utils.setFocusState(i,r,!1)}}},handleSubmit(i){return async function(n){n.preventDefault();let o=F();o.utils.setSubmitState({isActive:!0});let r=o.metadata,l=o.fields,p=o.validations,y={},u={},f={},S=!1,v;for(v in l){y[v]=l[v].value;try{let m=v in r.referencedValidatedFieldsMap&&p[v].handler;if(typeof m!="function"||!p[v].events.submit.isActive)continue;u[v]=m(l[v].value,"submit"),f[v]={name:v,message:null,validationEvent:"submit"}}catch(m){f[v]={name:v,message:o.utils.errorFormatter(m,"submit"),validationEvent:"submit"}}}let V;for(V of r.manualValidatedFields)try{let m=o.validations[V].handler;if(typeof m!="function")continue;u[V]=m(y,"submit"),f[V]={name:V,message:null,validationEvent:"submit"}}catch(m){f[V]={name:V,message:o.utils.errorFormatter(m,"submit"),validationEvent:"submit"}}let h=F(),E;for(E in f){let m=f[E];h=g(f[E])(h),typeof m.message=="string"&&(S=!0)}if(S)c(h),o.utils.setSubmitState(m=>({isActive:!1,counter:m.counter+1,failedAttempts:m.counter+1,errorMessage:null}));else try{await i({event:n,values:y,validatedValues:u,hasError:S,errors:f}),o.utils.setSubmitState(m=>({isActive:!1,counter:m.counter+1,passedAttempts:m.counter+1,errorMessage:null}))}catch(m){o.utils.setSubmitState(k=>({isActive:!1,counter:k.counter+1,failedAttempts:k.counter+1,errorMessage:o.utils.errorFormatter(m,"submit")}))}}}}})}export{N as createFormStoreBuilder,H as errorFormatter,C as formatDate,w as getFirstDateOfWeek,A as getWeekNumber,_ as handleCreateFormStore,W as inputDateHelpers,M as isZodError,D as isZodValidator,x as parseDate,z as useCreateFormStore};
//# sourceMappingURL=index.mjs.map