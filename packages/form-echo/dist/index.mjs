function g(e){return e instanceof Object&&"parseAsync"in e&&typeof e.parseAsync=="function"}function w(e){return e instanceof Object&&"errors"in e}function D(e){return w(e)?e.format()._errors.join(", "):e instanceof Error?e.message:"Something went wrong!"}function N(e,l){let t="";switch(l){case"date":t=e.toISOString().slice(0,10);break;case"time":t=e.toTimeString().slice(0,8);break;case"datetime-local":t=`${e.getFullYear()}-${`${e.getMonth()+1}`.padStart(2,"0")}-${`${e.getDate()}`.padStart(2,"0")}T${`${e.getHours()}`.padStart(2,"0")}:${`${e.getMinutes()}`.padStart(2,"0")}`;break;case"week":let n=e.getFullYear(),u=E(e);t=`${n}-W${u.toString().length<2?"0"+u.toString():u.toString()}`;break;case"month":t=e.toISOString().slice(0,7);break;default:break}return t}function H(e,l){let t;switch(l){case"date":t=new Date(e);break;case"time":let[n,u,o]=e.toString().split(":");t=new Date,t.setHours(Number(n||0)),t.setMinutes(Number(u||0)),t.setSeconds(Number(o||0));break;case"datetime-local":t=new Date(e.toString().replace(" ","T"));break;case"week":let[m,i]=e.toString().split("-W"),r=Number(m),s=Number(i);t=h(r,s);break;case"month":t=new Date(`${e}-01`);break;default:t=new Date;break}return t}function E(e){let l=new Date(e.getFullYear(),0,1),t=(e.valueOf()-l.valueOf())/(1e3*60*60*24);return Math.floor(t/7)+1}function h(e,l){let t=new Date(e,0,1),n=(8-t.getDay())%7,u=new Date(t);u.setDate(t.getDate()+n);let o=(l-1)*7,m=new Date(u);return m.setDate(u.getDate()+o),m}var j={formatDate:N,parseDate:H,getWeekNumber:E,getFirstDateOfWeek:h};import{createStore as C}from"zustand";import{useId as M,useState as T}from"react";var A=e=>C(k(e)),W=e=>{let l=M();return T(A({...e,baseId:e.baseId||l}))[0]};function I(e,l){if(!e.initValues||typeof e.initValues!="object")throw new Error("");let t={baseId:l,formId:`${l}_form`,fieldsNames:{},fieldsNamesMap:{},validatedFieldsNames:[],validatedFieldsNamesMap:{},manualValidatedFields:[],manualValidatedFieldsMap:[],referencedValidatedFields:[],referencedValidatedFieldsMap:[]};t.fieldsNames=Object.keys(e.initValues);for(let n of t.fieldsNames)t.fieldsNamesMap[n]=!0;for(let n in e.validationsSchema){if(t.validatedFieldsNames.push(n),t.validatedFieldsNamesMap[n]=!0,n in t.fieldsNamesMap){t.referencedValidatedFields.push(n),t.referencedValidatedFieldsMap[n]=!0;continue}t.manualValidatedFields.push(n),t.manualValidatedFieldsMap[n]=!0}return t}function x(e,l){let t={submit:!0},n=!1,u,o={};for(let m of l.validatedFieldsNames){let i=e.validationsSchema?.[m];if(o[m]={handler:i?g(i)?r=>i.parse(r):i:void 0,currentDirtyEventsCounter:0,failedAttempts:0,passedAttempts:0,events:{change:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null},submit:{failedAttempts:0,passedAttempts:0,isActive:!1,isDirty:!1,message:null}},isDirty:!1,metadata:{name:m}},e.validationEvents&&(n=!0,t={...t,...e.validationEvents}),n)for(u in t)o[m].events[u].isActive=!!typeof t[u]}return o}function $(e,l,t){let n=e.isUpdatingFieldsValueOnError??!0,u={};for(let o of t.fieldsNames)u[o]={value:e.initValues[o],isUpdatingValueOnError:n,valueFromFieldToStore:e.valuesFromFieldsToStore?.[o]?e.valuesFromFieldsToStore[o]:void 0,valueFromStoreToField:e.valuesFromStoreToFields?.[o]?e.valuesFromStoreToFields[o]:void 0,errors:null,isDirty:!1,id:`${l}field-${String(o)}`,metadata:{name:o,initialValue:e.initValues[o]}};return u}var P={fields:!0,validations:!0,submitCounter:!1};function k(e){let l=e.baseId?`${e.baseId}-`:"",t=I(e,l),n=$(e,l,t),u=x(e,t);return(o,m)=>({baseId:l,metadata:t,validations:u,fields:n,id:`${l}-form`,isDirty:!1,isSubmitting:!1,submitCounter:0,currentDirtyFieldsCounter:0,utils:{setIsSubmitting(i){o(function(r){return{...r,isSubmitting:typeof i=="function"?i(r.isSubmitting):i}})},resetFormStore:function(i=P){return o(function(r){let s=r.fields,a=r.validations,f=r.isDirty,y=r.submitCounter;if(i.fields)for(let d in s)s[d].value=s[d].metadata.initialValue;if(i.validations){for(let d in a){a[d].failedAttempts=0,a[d].passedAttempts=0,a[d].isDirty=!1;let F;for(F in a[d].events)a[d].events[F].failedAttempts=0,a[d].events[F].passedAttempts=0,a[d].events[F].isDirty=!1,a[d].events[F].message=null}f=!1}return i.submitCounter&&(y=0),{...r,fields:s,validations:a,isDirty:f,submitCounter:y}})},setFieldValue(i,r){return o(function(s){return{fields:{...s.fields,[i]:{...s.fields[i],value:typeof r=="function"?r(s.fields[i].value):r}}}})},setFieldErrors(i){o(function(r){if(!r.validations[i.name].events[i.validationEvent].isActive)return r;let s=r.currentDirtyFieldsCounter,a=r.validations[i.name],f=!!i.error;return f?(a.failedAttempts++,a.events[i.validationEvent].isDirty||(a.currentDirtyEventsCounter++,!a.isDirty&&a.currentDirtyEventsCounter>0&&s++),a.events[i.validationEvent].message=i.error,a.events[i.validationEvent].isDirty=f,a.events[i.validationEvent].failedAttempts++):(a.passedAttempts++,a.events[i.validationEvent].isDirty&&(a.currentDirtyEventsCounter--,a.isDirty&&a.currentDirtyEventsCounter===0&&s--),a.events[i.validationEvent].message=i.error,a.events[i.validationEvent].isDirty=f,a.events[i.validationEvent].passedAttempts++),a.isDirty=a.currentDirtyEventsCounter>0,{...r,currentDirtyFieldsCounter:s,isDirty:s>0,validations:{...r.validations,[i.name]:a}}})},errorFormatter:e.errorFormatter??D,handleOnInputChange(i,r,s){let a=m(),f=a.fields[i],y=typeof r=="function"?r(f.value):f.valueFromFieldToStore?f.valueFromFieldToStore(r):r,d=s||(a.metadata.referencedValidatedFieldsMap[i]?i:void 0);if(d&&a.validations[d].events.change.isActive)try{a.utils.setFieldValue(i,a.validations[d].handler(y,"change")),a.utils.setFieldErrors({name:d,error:null,validationEvent:"change"})}catch(F){a.utils.setFieldErrors({name:d,error:a.utils.errorFormatter(F,"change"),validationEvent:"change"}),f.isUpdatingValueOnError&&a.utils.setFieldValue(i,y)}else a.utils.setFieldValue(i,y)},handleSubmit(i){return async function(r){r.preventDefault();let s=m();s.utils.setIsSubmitting(!0);let a=s.metadata,f=s.fields,y=s.validations,d={},F={},p={},S=!1,c;for(c in f){d[c]=f[c].value;try{let v=c in a.referencedValidatedFieldsMap&&y[c].handler;y[c].events.submit.isActive&&typeof v=="function"&&(F[c]=v(f[c].value,"submit")),p[c]={name:c,error:null,validationEvent:"submit"}}catch(v){p[c]={name:c,error:s.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}}let V;for(V of a.manualValidatedFields)try{let v=s.validations[V].handler;typeof v=="function"&&(F[V]=v(d,"submit")),p[V]={name:V,error:null,validationEvent:"submit"}}catch(v){p[V]={name:V,error:s.utils.errorFormatter(v,"submit"),validationEvent:"submit"}}let b;for(b in p){let v=p[b];s.utils.setFieldErrors(p[b]),typeof v.error=="string"&&(S=!0)}s.utils.setIsSubmitting(!1),!S&&await i({event:r,values:d,validatedValues:F,hasError:S,errors:p})}}}})}export{k as createFormStoreBuilder,D as errorFormatter,N as formatDate,h as getFirstDateOfWeek,E as getWeekNumber,A as handleCreateFormStore,j as inputDateHelpers,w as isZodError,g as isZodValidator,H as parseDate,W as useCreateFormStore};
//# sourceMappingURL=index.mjs.map