import { createStore, useStore } from 'zustand';
import { useId, useRef, useMemo, useEffect } from 'react';
import { jsx, Fragment, jsxs } from 'react/jsx-runtime';
import { useReactTable, getCoreRowModel, getPaginationRowModel, getSortedRowModel, getFilteredRowModel, flexRender } from '@tanstack/react-table';

var B=({classNames:e={},pageViewMode:a="PAGING",canMultiRowSelect:n=!1,tableAutoToFixedOnLoad:o=!1,columnVisibility:s={},baseId:i="",queryInput:d})=>createStore(u=>({table:null,baseId:i,queryInput:d,classNames:e,pageViewMode:a,canMultiRowSelect:n,tableAutoToFixedOnLoad:o,columnFilters:[],rowSelection:{},columnVisibility:s,sorting:[],setPagination:t=>u(r=>{let g=typeof t=="function"?t({pageIndex:r.queryInput.offset||0,pageSize:r.queryInput.limit||0}):{pageIndex:t.pageIndex||r.queryInput.offset,pageSize:t.pageSize||r.queryInput.limit};return {queryInput:{...r.queryInput,limit:g.pageSize,offset:g.pageIndex}}}),setQueryInput:t=>u(r=>({queryInput:typeof t=="function"?t(r.queryInput):t})),setRowSelection:t=>u(r=>({rowSelection:typeof t=="function"?t(r.rowSelection):t})),setColumnFilters:t=>u(r=>({columnFilters:typeof t=="function"?t(r.columnFilters):t})),setColumnVisibility:t=>u(r=>({columnVisibility:typeof t=="function"?t(r.columnVisibility):t})),setSorting:t=>u(r=>({sorting:typeof t=="function"?t(r.sorting):t}))})),ae=e=>{let a=useId(),n=useRef(B({...e,baseId:e.baseId||a}));return useMemo(()=>{(n.current.getState().queryInput.limit!==e.queryInput.limit||n.current.getState().baseId!==e.baseId)&&n.current.setState(()=>({limit:e.queryInput.limit,baseId:e.baseId}));},[e.baseId,e.queryInput.limit]),n.current};var f=(...e)=>{let a="",n;for(n of e)typeof n=="string"&&(a+=n+" ");return a.trimEnd()},C=e=>{let a=useStore(e.store,u=>u.pageViewMode),n=useStore(e.store,u=>u.queryInput.offset||0),o=useMemo(()=>[],[]),s=useMemo(()=>a==="INFINITE_SCROLL"?(e.infiniteQuery?.data?.pages||o).map(u=>u.items).flat(1):e.infiniteQuery?.data?.pages?.[n]?.items||o,[n,e.infiniteQuery.data?.pages,a,o]),i=useMemo(()=>({offset:n,limit:e.infiniteQuery?.data?.pages.length||0}),[n,e.infiniteQuery?.data?.pages.length]);return useMemo(()=>({currentPage:s,pagination:{pageSize:i.limit,pageIndex:i.offset}}),[s,i.limit,i.offset])};var F=({infiniteQuery:e,store:a,classNames:n={container:"",loadMoreButton:""}})=>{let o=useStore(a,t=>t.queryInput.offset||0),s=useStore(a,t=>t),{isLastPageEmpty:i,isInBeforeLastPage:d}=useMemo(()=>{let t=e?.data?.pages?.[e.data.pages.length-1]?.items.length===0,r=o===0,g=o+1===e?.data?.pages?.length,T=typeof e?.data?.pages?.length=="number"&&e.data.pages.length!==0&&o+1===e.data.pages.length-1,l=e?.data?.pages?.length||0;return t&&l!==0&&l--,{isLastPageEmpty:t,isInBeforeLastPage:T,isInLastPage:g,isInFirstPage:r,pagesLength:l}},[o,e?.data?.pages]),u=useMemo(()=>!e.hasNextPage&&o+1===e.data?.pages.length||e.isFetching||d&&i,[o,e.data?.pages.length,e.hasNextPage,e.isFetching,d,i]);return e.hasNextPage?jsx("div",{className:f(n?.container),children:jsx("button",{title:u?"There is no more next page":"Next page",disabled:u,onClick:async()=>{u||await e.fetchNextPage().then(t=>{if(t.data&&Array.isArray(t.data?.pages)){let r=t.data.pages[t.data.pages.length-1];if(!r||d&&r.items.length===0)return}s.setQueryInput(r=>({...r,offset:(r.offset||0)+1}));});},className:f(n?.loadMoreButton),children:"load more"})}):jsx(Fragment,{})},q=F;var H=({store:e,...a})=>{let n=useStore(e,o=>o.classNames?.table);return jsx("table",{...a,className:n})},w=e=>jsx("thead",{...e}),L=e=>jsx("tbody",{...e});var y=e=>jsx("tr",{...e}),Q=e=>jsx("th",{...e}),h=e=>jsx("td",{...e}),S=({indeterminate:e,store:a,tContainerType:n,...o})=>{let s=useStore(a,d=>n==="thead"?d.classNames?.thead?.th?.selectCheckBoxContainer:d.classNames?.tbody?.td?.selectCheckBoxContainer),i=useRef(null);return useEffect(()=>{i.current&&typeof e=="boolean"&&(i.current.indeterminate=!o.checked&&e);},[e,o.checked]),jsx("div",{className:s?._,children:jsx("input",{type:"checkbox",ref:i,className:s?.checkbox,...o})})};var Z=({table:e,store:a})=>{let n=useStore(a,o=>o.classNames.thead);return jsx(w,{className:n?._,children:e.getHeaderGroups().map(o=>jsx(y,{className:n?.tr,children:o.headers.map(s=>jsx(Q,{"data-id":s.id,className:n?.th?._,"data-select-th":s.id==="select"?!0:void 0,children:s.isPlaceholder?null:flexRender(s.column.columnDef.header,s.getContext())},s.id))},o.id))})},$=({table:e,columnsLength:a,store:n})=>{let o=useStore(n,s=>s.classNames.tbody);return jsx(L,{className:o?._,"data-state":e.getRowModel().rows?.length>0?void 0:"empty",children:e.getRowModel().rows?.length>0?e.getRowModel().rows.map(s=>jsx(y,{"data-state":s.getIsSelected()&&"selected",className:o?.tr,children:s.getVisibleCells().map(i=>jsx(h,{className:o?.td?._,"data-select-td":i.column.id==="select"?!0:void 0,children:flexRender(i.column.columnDef.cell,i.getContext())},i.id))},s.id)):jsx(y,{"data-state":"empty",children:jsx(h,{colSpan:a,"data-state":"empty",className:"h-24 text-center",children:"No results."})})})},j=({columns:e,store:a,infiniteQuery:n})=>{let o=useStore(a,l=>l),s=useStore(a,l=>l.canMultiRowSelect),i=useMemo(()=>[{id:"select",header:({table:l})=>jsx(S,{checked:l.getIsAllRowsSelected(),indeterminate:l.getIsSomeRowsSelected(),onChange:l.getToggleAllRowsSelectedSchema(),tContainerType:"thead",store:a}),cell:({row:l})=>jsx(S,{checked:l.getIsSelected(),indeterminate:l.getIsSomeSelected(),onChange:l.getToggleSelectedSchema(),tContainerType:"tbody",store:a}),enableSorting:!1,enableHiding:s},...e],[s,e,a]),d=useStore(a,l=>l.sorting),u=useStore(a,l=>l.columnFilters),t=useStore(a,l=>l.columnVisibility),r=useStore(a,l=>l.rowSelection),g=C({infiniteQuery:n,store:a}),T=useReactTable({data:g.currentPage,columns:i,onSortingChange:o.setSorting,onColumnFiltersChange:o.setColumnFilters,getCoreRowModel:getCoreRowModel(),getPaginationRowModel:getPaginationRowModel(),getSortedRowModel:getSortedRowModel(),getFilteredRowModel:getFilteredRowModel(),onPaginationChange:o.setPagination,onColumnVisibilityChange:o.setColumnVisibility,onRowSelectionChange:o.setRowSelection,manualPagination:!0,manualFiltering:!0,manualSorting:!0,state:{pagination:g.pagination,sorting:d,columnFilters:u,columnVisibility:t,rowSelection:r}});return useEffect(()=>a.setState({table:T}),[a,T]),jsxs(H,{store:a,children:[jsx(Z,{table:T,store:a}),jsx($,{table:T,columnsLength:e.length,store:a})]})},V=j;

export { V as QueryTable, q as TableLoadMore, B as handleCreateTableStore, ae as useCreateTableStore };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.mjs.map